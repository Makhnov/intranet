function whereAmI(){const e=document.body?document.body.getAttribute("class"):"",t=document.querySelector("header"),n=t&&t.querySelector("h1")?t.querySelector("h1").textContent:"";console.log(e),e.includes("homepage")&&(console.log("Page d'accueil du Dashboard d√©tect√©e"),accueil()),document.querySelector("#id_use_map")&&(console.log("Page de l'amicale d√©tect√©e"),amicale()),document.querySelector("body.ready ul.listing.cgs-quick")&&(console.log("Page quickcreate d√©tect√©e"),quickcreate()),n.includes("Agents")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de FAQ d√©tect√©e"),faq()),document.querySelector("#listing-results.users")&&(console.log("Page d'affichage des utilisateurs d√©tect√©e"),usersList()),document.querySelector("form[action^='/admin/users/'][method='post']")&&(console.log("Cr√©ation/√©dition d'utilisateur d√©tect√©e"),userCommissionUpdate(),userElectedUpdate()),document.querySelector("form[action*='joyous/simpleeventpage/'][method='post']")&&(console.log("Cr√©ation/√©dition d'√©v√®nement d√©tect√©e"),joyousSingleEvent()),n.includes("Convocation")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de convocation d√©tect√©e"),convocationDate()),n.includes("Compte-rendu")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de compte-rendu d√©tect√©e"),compteRenduUsers(),compteRenduImportBloc())}function collapsible(e){e.closest(".cgs-collapsible").classList.toggle("cgs-collapsed")}function userFunctionUpdate(){console.log("Mise √† jour de l'input pour la liste des fonctions relative aux commissions");const e=document.querySelectorAll('input[name="commissions"]:checked'),t=[];e.forEach((e=>{const n=document.querySelector(`select[data-id="${e.value}"]`);n&&t.push({commission:e.value,function:n.value})})),document.getElementById("id_functions_commissions").value=JSON.stringify(t)}function createInfoBlock(e,t){if(!document.getElementById(e)){const n=document.createElement("div");n.classList.add("cgs-warning"),n.setAttribute("id",e);const o=document.createElement("p");return o.classList.add("warning-message"),o.textContent=t,n.appendChild(o),n}}function removeInfoBlock(e){const t=document.getElementById(e);t&&t.remove()}function accueil(){document.querySelectorAll(".w-summary__list svg.icon").forEach((function(e){let t=e.nextElementSibling.getAttribute("href");e.addEventListener("click",(function(){window.location.href=t}))}))}function amicale(){const e=document.querySelector("#id_use_map"),t=["map_details","details_de_la_carte","detalles_del_mapa"];let n,o;for(let e of t)if(o=`panel-child-contenu-${e}-content`,n=document.querySelector(`#${o}`),n)break;const c=document.querySelector(`.w-panel__toggle[aria-controls="${o}"]`);function s(){e.checked?(c.setAttribute("aria-expanded","true"),n.classList.remove("disabled"),n.querySelectorAll("input, select, textarea").forEach((e=>e.disabled=!1)),n.removeAttribute("hidden")):(c.setAttribute("aria-expanded","false"),n.classList.add("disabled"),n.querySelectorAll("input, select, textarea").forEach((e=>e.disabled=!0)),n.setAttribute("hidden",""))}s(),e.addEventListener("change",s)}function quickcreate(){const e=document.querySelector("body.ready ul.listing"),t=document.querySelectorAll("body.ready ul.listing li"),n=document.createElement("li");n.classList.add("list","cgs-closed"),n.setAttribute("data-name","Commissions et groupes de travail"),n.setAttribute("data-model","CommissionPage");const o=document.createElement("a");o.classList.add("icon","icon-plus-inverse","icon-larger"),o.setAttribute("ID","commissions-dropdown"),o.setAttribute("alt","Ouvrir le menu d√©roulant des commissions ou groupes de travail"),o.setAttribute("title","Afficher toutes les commissions et groupes de travail");const c=document.createElement("strong");c.textContent="Commissions et groupes de travail";const s=document.createElement("span");s.textContent="‚ñ∂Ô∏è";const i=document.createElement("ul");i.classList.add("com-listing","cgs-quick","cgs-hidden"),o.appendChild(c),o.appendChild(s),n.appendChild(o),n.appendChild(i),e.appendChild(n),o.addEventListener("click",(function(){i.classList.toggle("cgs-hidden"),n.classList.toggle("cgs-closed"),i.classList.contains("cgs-hidden")?(s.textContent="‚ñ∂Ô∏è",o.setAttribute("title","Afficher toutes les commissions et groupes de travail"),o.setAttribute("alt","Ouvrir le menu d√©roulant des commissions ou groupes de travail")):(s.textContent="üîΩ",o.setAttribute("title","Masquer toutes les commissions et groupes de travail"),o.setAttribute("alt","Fermer le menu d√©roulant des commissions ou groupes de travail"))})),t.forEach((e=>{if("CommissionPage"===e.getAttribute("data-model")){const t=e.cloneNode(!0);i.appendChild(t),e.remove()}}))}function faq(){document.querySelectorAll("thead th a").forEach((e=>{e.title.includes("Titre")&&(e.textContent=`${e.textContent}: [Th√©matique] - [Cibles] - [Mots-clef]`)}))}function usersList(){const e=document.querySelector("header .left"),t=document.createElement("select");t.id="pagination-select";const n=new URLSearchParams(window.location.search).get("paginate_by")||"20";function o(e,t,n){let o="";const c=e.split("?"),s=c[0];let i=c[1],l="";if(i){const e=i.split("&");for(let n=0;n<e.length;n++)e[n].split("=")[0]!=t&&(o+=l+e[n],l="&")}return s+"?"+o+(l+""+t+"="+n)}[{value:"20",text:"20"},{value:"50",text:"50"},{value:"100",text:"100"},{value:"10000",text:"Tous"}].forEach((e=>{const o=document.createElement("option");o.value=e.value,o.textContent=e.text,e.value===n&&(o.selected=!0,o.setAttribute("selected","selected")),t.appendChild(o)})),e.appendChild(t),t.addEventListener("change",(function(){const e=this.value;let t;t=o(window.location.href,"paginate_by","all"===e?"":e),window.location.href=t}))}function userCommissionUpdate(){const e=document.getElementById("id_commissions"),t=document.getElementById("id_functions_commissions"),n=JSON.parse(t.value),o=Array.from(e.options).sort(((e,t)=>e.textContent.localeCompare(t.textContent))),c=document.createElement("div");c.setAttribute("id","id_commissions");const s=document.createElement("div");s.setAttribute("id","id_functions_commissions_list");const i=e.parentElement,l=i.parentElement,a=l.parentElement,d=t.parentElement,r=d.parentElement,u=r.parentElement,m=document.getElementById("commissions-content"),p=m.querySelectorAll(".w-field__errors[data-field-errors]");for(const e of p)e.children.length>0&&(console.log("ERREUR TROUVEE"),m.insertBefore(e,m.firstChild));o.forEach(((e,t)=>{const{function:o}=n.find((({commission:t})=>t===e.value))||{},i=document.createElement("div"),l=document.createElement("div"),a=document.createElement("label"),d=function(e,t,n){const o=document.createElement("select");o.classList.add("cgs-selector"),o.setAttribute("title",e),o.setAttribute("data-id",t);const c=document.createElement("option");c.value="",c.selected=!0,c.textContent="---------",o.appendChild(c);const s=document.createElement("option");s.value="3",s.textContent="Membre",o.appendChild(s);const i=document.createElement("option");i.value="1",i.textContent="Pr√©sident",o.appendChild(i);const l=document.createElement("option");l.value="2",l.textContent="Charg√© de commission",o.appendChild(l),void 0!==n&&(o.classList.add("cgs-checked"),o.value=n);return o}(e.textContent,e.value,o),r=document.createElement("input");a.setAttribute("for",`id_commissions_${t}`),r.setAttribute("id",`id_commissions_${t}`),r.setAttribute("type","checkbox"),r.setAttribute("name","commissions"),r.setAttribute("value",e.value),e.selected&&r.setAttribute("checked","checked"),r.addEventListener("change",(function(){const e=document.querySelector(`select[data-id="${this.value}"]`);this.checked?(e.classList.add("cgs-checked"),""===e.value&&(e.value="3")):(e.classList.remove("cgs-checked"),e.value="")})),a.appendChild(r),a.appendChild(document.createTextNode(e.textContent)),i.appendChild(a),l.appendChild(d),c.appendChild(i),c.addEventListener("change",userFunctionUpdate),s.appendChild(l),s.addEventListener("change",userFunctionUpdate)})),i.replaceChild(c,e),d.replaceChild(s,t),function(e){const t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name","functions_commissions"),t.setAttribute("id","id_functions_commissions"),e.appendChild(t)}(s),l.className="w-field w-field--model_multiple_choice_field w-field--checkbox_select_multiple",r.className="w-field w-field--model_multiple_choice_field w-field--checkbox_select_multiple",a.removeChild(a.querySelector("label")),u.removeChild(u.querySelector("label")),userFunctionUpdate()}function userElectedUpdate(){const e=document.querySelector("#id_municipality"),t=document.querySelector("#id_function_municipality"),n=document.querySelector("#id_function_council"),o=document.querySelector("#commissions-section"),c=document.querySelector("#id_function_bureau"),s=document.querySelector("#id_function_conference"),i=document.querySelectorAll("#id_commissions input[type='checkbox']"),l=document.querySelectorAll("#id_functions_commissions_list select"),a=document.querySelectorAll("#id_functions_commissions_list option[value='2']");function d(){function d(e){a.forEach((t=>{t.disabled=!e,e||(t.selected=!1)}))}e.value?t.classList.remove("cgs-panel-disabled"):(t.classList.add("cgs-panel-disabled"),t.value=""),t.value?(n.classList.remove("cgs-panel-disabled"),o.classList.remove("cgs-panel-disabled")):(n.classList.add("cgs-panel-disabled"),o.classList.add("cgs-panel-disabled"),n.value="",c.value="",s.value="",i.forEach((e=>{e.checked=!1})),l.forEach((e=>{console.log(e),e.value="",e.classList.remove("cgs-checked")})),userFunctionUpdate()),"1"===n.value?(s.value="1",c.value="1",d(!1)):"2"===n.value?(s.value="2",c.value="2",d(!0)):(s.value="1"===t.value?"3":"",c.value="",d(!1))}document.querySelectorAll("#id_municipality, #id_function_municipality, #id_function_council, #id_commissions").forEach((e=>{e.addEventListener("change",d)})),t.classList.add("cgs-panel-disabled"),n.classList.add("cgs-panel-disabled"),c.classList.add("cgs-panel-disabled"),o.classList.add("cgs-panel-disabled"),s.classList.add("cgs-panel-disabled"),d()}function joyousSingleEvent(){const e=document.querySelector("#id_convocation"),t=e.value;function n(e){fetch("/api/v2/pages/"+e).then((e=>e.json())).then((e=>{const t=e.title.replace("Convocation ",""),n=t.charAt(0).toUpperCase()+t.slice(1),o=t.toLowerCase().replace(/ /g,"-");document.getElementById("id_title").value=n,document.getElementById("id_slug").value=o;const c=new Date(e.date);if(document.getElementById("id_date").value=function(e){return e.toISOString().split("T")[0]}(c),document.getElementById("id_time_from").value=function(e){return e.toTimeString().split(" ")[0].substring(0,5)}(c),document.getElementById("id_location").value="H√¥tel communautaire. 15, avenue du Comminges 31260 MANE",document.getElementById("id_website").value="https://cagiregaronnesalat.fr/"+o+"/",e.meta.parent.meta.logo){!function(e){const t=document.getElementById("id_image"),n=document.getElementById("id_image-chooser"),o=n.querySelector("img"),c=document.getElementById("id_image-title");t&&(t.value=e.id,c.innerText=e.title,o.alt=e.title,o.src=e.url,n.classList.remove("blank"))}(e.meta.parent.meta.logo)}})).catch((e=>console.error("Error:",e)))}t&&n(t),e.addEventListener("change",(function(){const e=this.value;e&&n(e)}))}function convocationDate(){const e=document.querySelector("#id_date"),t=document.querySelector("#panel-child-contenu-body-section"),n=document.querySelector("#panel-child-contenu-pieces_jointes-section");function o(e){console.log("Fonction checkConvocationDate");const o=e.value,c=new Date,s=String(c.getDate()).padStart(2,"0"),i=String(c.getMonth()+1).padStart(2,"0");if(o<c.getFullYear()+"-"+i+"-"+s){t.classList.add("cgs-hidden");const e=createInfoBlock("cv-date","La date de la convocation est ant√©rieure √† la date du jour. Ajoutez simplement l'ancienne convocation en pi√®ce jointe üîó (format PDF ou DOCX).");e&&n.appendChild(e)}else removeInfoBlock("cv-date"),t.classList.remove("cgs-hidden")}e&&o(e),e.addEventListener("change",(function(){o(this)}))}function compteRenduUsers(){const e=document.querySelector("#id_convocation"),t=document.querySelector("#id_secretary"),n=document.querySelector('[data-id="secretary"]'),o=document.querySelector('[data-id="absences"]'),c=document.querySelector("#id_replaced_users"),s=document.querySelector("#id_unreplaced_users"),i=document.querySelector('[data-id="quorum"]'),l=document.querySelector('[data-id="body"]'),a=document.querySelector('[data-id="attachments"]');t.innerHTML="",c.innerHTML="",s.innerHTML="";const d=e.value;function r(e,n){const o=document.createElement("option");o.textContent="---------",o.value="",t.appendChild(o),e.forEach((e=>{const o=document.createElement("option");o.value=e.id,o.textContent=e.name,n===e.id&&o.setAttribute("selected","selected"),t.appendChild(o)}))}function u(e){fetch("/api/v2/users/?limit=10000").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((t=>{if(t&&t.items){const n=t.items.filter((e=>e.elected));e(null,n)}else e("Items not found in response",null)})).catch((t=>{e(t.message,null)}))}function m(e,t,n,o,c){let s,i=[],l=[];t.forEach(((t,a)=>{const d=document.createElement("div"),r=document.createElement("label");r.setAttribute("for",e.id+"_"+a);const u=document.createElement("input");if(u.setAttribute("type","checkbox"),u.setAttribute("name",c),u.setAttribute("value",t.id),u.setAttribute("sub-value",t.user),u.setAttribute("id",e.id+"_"+a),s=!1,t.presence===n&&(u.checked=!0,l.push(u),o&&(r.classList.add("cgs-checked"),s=!0)),r.appendChild(u),r.appendChild(document.createTextNode(" "+t.identity)),d.appendChild(r),o){let e=!1,n=!1,l=[t.id,t.user,!1];const r=document.createElement("option");r.value=l;const u=document.createElement("select");u.setAttribute("name","substitute_users"),u.setAttribute("id","id_substitute_users_"+a),u.appendChild(r),o.forEach((o=>{l[2]=o.id;const c=document.createElement("option");c.value=l,c.textContent=o.name,c.setAttribute("sub-value",o.id),t.substitute===o.id&&(e&&(u.querySelector("option:selected").removeAttribute("selected"),i=i.filter((e=>e!==u.querySelector("option:selected")))),c.setAttribute("selected","selected"),i.push(c),n=!0),n||t.alternate!==o.id||(c.setAttribute("selected","selected"),i.push(c),e=!0),u.appendChild(c)}));const m=document.createElement("label");m.setAttribute("for","id_"+c+"_substitutes_"+a),m.appendChild(u),d.appendChild(m),e||n?s||(r.selected=!0):r.setAttribute("selected","selected")}e.appendChild(d)}));for(const e of l)g(null,e);for(const e of i)h(null,e.parentElement)}function p(e){const t=e.target,n=t.name,o=t.value;let c="replaced_users"===n?`input[name="unreplaced_users"][value="${o}"]`:`input[name="replaced_users"][value="${o}"]`,s=document.querySelector(c);return!(!s||!s.checked)&&(function(e){const t=e.parentElement;t.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",e.style.animation="colorized 0.82s ease-in-out both",t.addEventListener("animationend",(()=>{t.style.animation=""})),e.addEventListener("animationend",(()=>{e.style.animation=""}))}(t.parentElement),t.checked=!1,!0)}function h(e,t){let n=e?e.target:t;const o=n.options;let c;for(const e of o)e.classList.contains("cgs-selected")&&(c=e.getAttribute("sub-value")),e.classList.remove("cgs-selected");const s=o[n.selectedIndex];s.classList.add("cgs-selected");const i=s.value;!function(e=!1,t=!1,n=!1){let o,c;n?(e&&(o=document.querySelectorAll(`option[sub-value="${e}"]:not([value="${n}"])`)),t&&(c=document.querySelectorAll(`option[sub-value="${t}"]:not([value="${n}"])`))):(e&&(o=document.querySelectorAll(`option[sub-value="${e}"]`)),t&&(c=document.querySelectorAll(`option[sub-value="${t}"]`))),e&&o.forEach((e=>{e.disabled=!1})),t&&c.forEach((e=>{e.disabled=!0}))}(c,s.getAttribute("sub-value"),i)}function g(e,t){let n=e?e.target:t;if("replaced_users"===n.name){const e=n.id;h(null,document.getElementById(e.replace("replaced_users","substitute_users")))}const o=n.getAttribute("sub-value"),c=document.querySelectorAll(`option[sub-value="${o}"], #id_secretary option[value="${o}"]`);for(const e of c)e.disabled=n.checked}function f(e){switch(e){case 1:document.querySelectorAll('input[name="replaced_users"]').forEach((e=>{e.addEventListener("change",(e=>{p(e)||(!function(e){const t=e.target,n=t.parentElement;let o=null,c=null;n.nextElementSibling&&(o=n.nextElementSibling.querySelector("option"),c=n.nextElementSibling.querySelector("option[selected='selected']")),t.checked?(n.classList.add("cgs-checked"),c&&(c.selected=!0)):(n.classList.remove("cgs-checked"),o&&(o.selected=!0))}(e),g(e))}))}));break;case 2:document.querySelectorAll('input[name="unreplaced_users"]').forEach((e=>{e.addEventListener("change",(e=>{p(e)||g(e)}))}));break;case 3:document.querySelectorAll('select[name="substitute_users"]').forEach((e=>{e.addEventListener("change",h)}))}}function v(e){if(e){n.classList.add("cgs-hidden"),o.classList.add("cgs-hidden"),i.classList.add("cgs-hidden"),l.classList.add("cgs-hidden");const e=createInfoBlock("cr-old","Cette page est li√©e √† une ancienne convocation. Ajoutez simplement le compte-rendu en pi√®ce jointe üîó (format PDF ou DOCX).");e&&a.insertBefore(e,a.firstChild.nextSibling)}else n.classList.remove("cgs-hidden"),o.classList.remove("cgs-hidden"),i.classList.remove("cgs-hidden"),l.classList.remove("cgs-hidden"),removeInfoBlock("cr-old")}function b(e){fetch("/api/v2/pages/"+e+"/").then((e=>e.json())).then((e=>{if(!!e.old&&e.old)throw new Error("Ancienne convocation d√©tect√©e");v(!1);const t=!!e.convocation_users&&e.convocation_users,c=!!e.meta.parent&&e.meta.parent.meta.type,s=!!e.compte_rendu_page&&e.compte_rendu_page.secretary;if(e&&c)switch(c){case"administration.ConseilsIndexPage":console.log("Compte-rendu de conseil d√©tect√© (on affiche tout)"),u((function(n,o){n?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",n):e&&(r(o,s),t&&(m(document.querySelector("#id_replaced_users"),t,2,o,"replaced_users"),m(document.querySelector("#id_unreplaced_users"),t,3,!1,"unreplaced_users"),f(1),f(2),f(3)))}));break;case"administration.BureauxIndexPage":console.log("Compte-rendu de bureau d√©tect√© (on cache tout)");break;case"administration.CommissionPage":console.log("Compte-rendu de commission d√©tect√© (on n'affiche que le secr√©taire de s√©ance)"),u((function(t,n){t?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",t):e&&r(n,s)})),o.classList.add("cgs-hidden"),i.classList.add("cgs-hidden");break;case"administration.ConferencesIndexPage":console.log("Compte-rendu de conf√©rence d√©tect√© (on affiche tout sauf le secr√©taire de s√©ance)"),u((function(n,o){n?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",n):e&&t&&(m(document.querySelector("#id_replaced_users"),t,2,o,"replaced_users"),m(document.querySelector("#id_unreplaced_users"),t,3,!1,"unreplaced_users"),f(1),f(2),f(3))})),n.classList.add("cgs-hidden")}})).catch((e=>{"Ancienne convocation d√©tect√©e"===e.message?(console.log(e.message),v(!0)):console.error("Erreur lors de la r√©cup√©ration des utilisateurs de la convocation :",e)}))}d&&b(d),e.addEventListener("change",(function(){c.innerHTML="",s.innerHTML="";const e=this.value;e&&b(e)}))}function compteRenduImportBloc(){const e=document.querySelector("#panel-child-contenu-body-content [data-streamfield-stream-container]"),t=e.querySelectorAll(":scope > [data-contentpath]");Array.from(t).filter((e=>e.querySelector('input[type="hidden"][value="PDF"]')||e.querySelector('input[type="hidden"][value="DOCX"]'))).forEach((e=>{e.dataset.observed=!0}));const n=new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target;t.dataset.contentpath&&(t.querySelector('input[type="hidden"][value="PDF"]')||t.querySelector('input[type="hidden"][value="DOCX"]'))&&(!function(e){const t=e.querySelector('[data-contentpath="pdf_import"]')||e.querySelector('[data-contentpath="docx_import"]'),n=t.parentElement,o=t.dataset.contentpath.split("_")[0];(function(e,t){e.classList.add("cgs-colbox"),e.querySelector(`[data-contentpath="${t}_document"]`).classList.add("cgs-col8"),e.querySelector(`[data-contentpath="${t}_import"]`).classList.add("cgs-col4");const n=e.querySelector('[data-contentpath="pdf_images"]')||e.querySelector('[data-contentpath="docx_content"]');n.classList.add("cgs-col12","cgs-collapsible","cgs-collapsed");const o=n.querySelector("label");console.log(o),o.addEventListener("click",(()=>collapsible(o)))})(n,o),function(e,t){const n=e.querySelector(`[id^="body-"][id$="-value-${t}_import"]`),o=document.querySelector('form#page-edit-form footer nav button[type="submit"].action-save').cloneNode(!0);if(o){o.removeChild(o.querySelector("svg.button-longrunning__icon")),o.classList.add("cgs-import"),o.dataset.wProgressLabelValue="Importer le "+t,o.dataset.wProgressActiveValue="Importation‚Ä¶";const e=n.cloneNode(!0);n.replaceWith(o),o.addEventListener("click",(function(t){t.preventDefault();const n=o.closest("form");n?(e.value="on",e.type="hidden",n.appendChild(e),n.submit()):console.log("Formulaire non trouv√©")}))}}(n,o)}(t),n.unobserve(t))}))}),{threshold:0}),o=e.children;for(let e=0;e<o.length;e++)n.observe(o[e]);new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.length&&(()=>{const t=e.querySelectorAll(":scope > *:not([data-observed])");for(let e=0;e<t.length;e++)t[e].dataset.observed=!0,n.observe(t[e])})()}))})).observe(e,{childList:!0})}document.addEventListener("DOMContentLoaded",(function(){whereAmI()}));