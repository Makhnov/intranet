function whereAmI(){var e=document.body?document.body.getAttribute("class"):"",t=document.querySelector("header"),n=t&&t.querySelector("h1")?t.querySelector("h1").textContent:"";console.log(e),e.includes("login")&&(console.log("Page de connexion détectée"),login()),e.includes("homepage")&&(console.log("Page d'accueil du Dashboard détectée"),accueil()),document.querySelector("#id_use_map")&&(console.log("Page de l'amicale détectée"),amicale()),document.querySelector("body.ready ul.listing.cgs-quick")&&(console.log("Page quickcreate détectée"),quickcreate()),n.includes("Agents")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de FAQ détectée"),faq()),document.querySelector("#listing-results.users")&&(console.log("Page d'affichage des utilisateurs détectée"),list_users()),document.querySelector("form[action^='/admin/users/'][method='post']")&&(console.log("Création/édition d'utilisateur détectée"),edit_users_elected()),document.querySelector("form[action*='joyous/simpleeventpage/'][method='post']")&&(console.log("Création/édition d'évènement détectée"),single_event()),n.includes("Compte-rendu")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de compte-rendu détectée"),compteRendu())}function login(){var e=document.querySelector("span.cgs-eye");const t=document.getElementById("id_username"),n=document.getElementById("id_login"),c=document.getElementById("id_password"),o=(e.addEventListener("click",function(){this.classList.toggle("cgs-hidden"),this.classList.contains("cgs-hidden")?c.setAttribute("type","password"):c.setAttribute("type","text")}),document.querySelector(".form-actions div.fake")),i=document.querySelectorAll(".w-field__input input");function l(t){t.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",t.firstElementChild.style.animation="colorized 0.82s ease-in-out both",t.addEventListener("animationend",function e(){t.style.animation="",t.removeEventListener("animationend",e),t.firstElementChild.style.animation="",t.firstElementChild.removeEventListener("animationend",e)})}i.forEach(function(e){function t(e){""!==e.value?e.closest(".cgs-form-block").classList.add("cgs-input"):e.closest(".cgs-form-block").classList.remove("cgs-input"),e=Array.from(i).every(e=>""!==e.value),o.style.zIndex=e?"-1":"2"}e.addEventListener("focus",function(){this.closest(".cgs-form-block").classList.add("cgs-focus")}),e.addEventListener("blur",function(){this.closest(".cgs-form-block").classList.remove("cgs-focus")}),e.addEventListener("input",function(){t(this)}),t(e)}),o.addEventListener("click",function(){let e=!0;null===t||t.value.trim()?null===n||n.value.trim()||(l(n.closest(".cgs-form-block")),e=!1):(l(t.closest(".cgs-form-block")),e=!1),c.value.trim()||(l(c.closest(".cgs-form-block")),e=!1)})}function accueil(){document.querySelectorAll(".w-summary__list svg.icon").forEach(function(e){let t=e.nextElementSibling.getAttribute("href");e.addEventListener("click",function(){window.location.href=t})})}function amicale(){const e=document.querySelector("#id_use_map");var t;let n,c;for(t of["map_details","details_de_la_carte","detalles_del_mapa"])if(c=`panel-child-contenu-${t}-content`,n=document.querySelector("#"+c))break;const o=document.querySelector(`.w-panel__toggle[aria-controls="${c}"]`);function i(){e.checked?(o.setAttribute("aria-expanded","true"),n.classList.remove("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!1),n.removeAttribute("hidden")):(o.setAttribute("aria-expanded","false"),n.classList.add("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!0),n.setAttribute("hidden",""))}i(),e.addEventListener("change",i)}function quickcreate(){let n=[];if(document.querySelectorAll("body.ready ul.listing li a").forEach(function(e){e.innerHTML.includes("Commissions &gt;")?(n.push({href:e.getAttribute("href"),text:e.querySelector("strong").textContent}),e.parentElement.remove()):e.innerHTML=e.querySelector("strong").outerHTML}),n.length){let t='<li><a class="icon icon-plus-inverse icon-larger toggle-commissions hidden"><strong>Commissions</strong></a><ul id="commissions" class="hidden">';n.forEach(function(e){t+=`<li><a href="${e.href}">${e.text}</a></li>`}),t+="</ul></li>",document.querySelector("body.ready ul.listing").insertAdjacentHTML("beforeend",t)}document.querySelectorAll(".toggle-commissions").forEach(function(e){e.addEventListener("click",function(){document.getElementById("commissions").classList.toggle("hidden"),e.classList.toggle("hidden")})})}function faq(){document.querySelectorAll("thead th a").forEach(e=>{e.title.includes("Titre")&&(e.textContent=e.textContent+": [Thématique] - [Cibles] - [Mots-clef]")})}function list_users(){var e=document.querySelector("header .left");const n=document.createElement("select");n.id="pagination-select";const c=new URLSearchParams(window.location.search).get("paginate_by")||"20";function o(e,t,n){let c="";const o=e.split("?");var e=o[0],i=o[1];let l="";if(i){const o=i.split("&");for(let e=0;e<o.length;e++)o[e].split("=")[0]!=t&&(c+=l+o[e],l="&")}i=l+""+t+"="+n;return e+"?"+c+i}[{value:"20",text:"20"},{value:"50",text:"50"},{value:"100",text:"100"},{value:"10000",text:"Tous"}].forEach(e=>{var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.value===c&&(t.selected=!0,t.setAttribute("selected","selected")),n.appendChild(t)}),e.appendChild(n),n.addEventListener("change",function(){var e=this.value;let t;t=o(window.location.href,"paginate_by","all"===e?"":e),window.location.href=t})}function edit_users_elected(){const o=["conference","commission","council"];function t(){var e=document.querySelector("#id_function_municipality").value,t=document.querySelector("#id_function_council").value,n=document.querySelector("#id_commission").value,c=document.querySelector("#id_function_commission").options,c=(c[2].disabled="2"!==t,document.querySelector("#id_commission")),c=(["1","2","3"].includes(t)?c.classList.remove("cgs-panel-disabled"):c.classList.add("cgs-panel-disabled"),document.querySelector("#id_function_commission"));""===n?c.classList.add("cgs-panel-disabled"):c.classList.remove("cgs-panel-disabled");document.querySelector("#id_function_bureau").value="1"===t?"1":"2"===t?"2":"";var n=document.querySelector("#id_function_conference");n.value="1"===t?"1":"2"===t?"2":"1"===e?"3":"",""===e?o.forEach(e=>{document.querySelectorAll(`#${e}-content select`).forEach(e=>e.classList.add("cgs-panel-disabled"))}):["1","2","3"].includes(e)&&(c=document.querySelector("#conference-content-hidden"),n=document.querySelector("#conference-content"),["1","2"].includes(t)||"1"===e?(c.classList.add("cgs-panel-hidden"),n.classList.remove("cgs-panel-hidden")):(c.classList.remove("cgs-panel-hidden"),n.classList.add("cgs-panel-hidden")),document.querySelector("#id_function_council").classList.remove("cgs-panel-disabled")),t=document.querySelector("#id_function_municipality").value,e=document.querySelector("#id_function_council").value,""===t&&(document.querySelector("#id_function_council").value="",document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="",document.querySelector("#id_function_bureau").value="",document.querySelector("#id_function_conference").value=""),""===e&&(document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="")}document.querySelectorAll("#id_function_municipality, #id_function_council, #id_commission").forEach(e=>{e.addEventListener("change",t)}),t(),document.querySelector("#id_function_conference").classList.add("cgs-panel-disabled"),document.querySelector("#id_function_bureau").classList.add("cgs-panel-disabled")}function single_event(){var e=document.querySelector("#id_convocation"),t=e.value;function n(e){fetch("/api/v2/pages/"+e).then(e=>e.json()).then(e=>{var t,n,c=e.title.replace("Convocation ",""),o=c.charAt(0).toUpperCase()+c.slice(1),c=c.toLowerCase().replace(/ /g,"-"),o=(document.getElementById("id_title").value=o,document.getElementById("id_slug").value=c,new Date(e.date));document.getElementById("id_date").value=o.toISOString().split("T")[0],document.getElementById("id_time_from").value=o.toTimeString().split(" ")[0].substring(0,5),document.getElementById("id_location").value="Hôtel communautaire. 15, avenue du Comminges 31260 MANE",document.getElementById("id_website").value="https://cagiregaronnesalat.fr/"+c+"/",e.meta.parent.meta.logo&&(o=e.meta.parent.meta.logo,c=o,e=document.getElementById("id_image"),o=document.getElementById("id_image-chooser"),t=o.querySelector("img"),n=document.getElementById("id_image-title"),e)&&(e.value=c.id,n.innerText=c.title,t.alt=c.title,t.src=c.url,o.classList.remove("blank"))}).catch(e=>console.error("Error:",e))}t&&n(t),e.addEventListener("change",function(){var e=this.value;e&&n(e)})}function compteRendu(){var e=document.querySelector("#id_convocation");const i=document.querySelector("#id_secretary"),t=document.querySelector("#id_replaced_users"),n=document.querySelector("#id_unreplaced_users");i.innerHTML="",t.innerHTML="",n.innerHTML="";var c=e.value;function l(n,e,c,a,u){let d,m=[],o=[];e.forEach((i,e)=>{var t=document.createElement("div"),l=document.createElement("label"),s=(l.setAttribute("for",n.id+"_"+e),document.createElement("input"));if(s.setAttribute("type","checkbox"),s.setAttribute("name",u),s.setAttribute("value",i.id),s.setAttribute("sub-value",i.user),s.setAttribute("id",n.id+"_"+e),d=!1,i.presence===c&&(s.checked=!0,o.push(s),a)&&(l.classList.add("cgs-checked"),d=!0),l.appendChild(s),l.appendChild(document.createTextNode(" "+i.identity)),t.appendChild(l),a){let n=!1,c=!1,o=[i.id,i.user,!1];s=document.createElement("option");s.value=o;const r=document.createElement("select");r.setAttribute("name","substitute_users"),r.setAttribute("id","id_substitute_users_"+e),r.appendChild(s),a.forEach(e=>{o[2]=e.id;var t=document.createElement("option");t.value=o,t.textContent=e.name,t.setAttribute("sub-value",e.id),i.substitute===e.id&&(n&&(r.querySelector("option:selected").removeAttribute("selected"),m=m.filter(e=>e!==r.querySelector("option:selected"))),t.setAttribute("selected","selected"),m.push(t),c=!0),c||i.alternate!==e.id||(t.setAttribute("selected","selected"),m.push(t),n=!0),r.appendChild(t)});l=document.createElement("label");l.setAttribute("for","id_"+u+"_substitutes_"+e),l.appendChild(r),t.appendChild(l),n||c?d||(s.selected=!0):s.setAttribute("selected","selected")}n.appendChild(t)});for(const t of o)f(null,t);for(const i of m)r(null,i.parentElement)}function s(e){var e=e.target,t=e.name,n=e.value,t=document.querySelector("replaced_users"===t?`input[name="unreplaced_users"][value="${n}"]`:`input[name="replaced_users"][value="${n}"]`);if(t&&t.checked){{var c=e.parentElement;const o=c.parentElement;o.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",c.style.animation="colorized 0.82s ease-in-out both",o.addEventListener("animationend",()=>{o.style.animation=""}),c.addEventListener("animationend",()=>{c.style.animation=""})}return e.checked=!1,1}}function r(n,c){n=n?n.target:c,c=n.options;let o;for(const e of c)e.classList.contains("cgs-selected")&&(o=e.getAttribute("sub-value")),e.classList.remove("cgs-selected");c=c[n.selectedIndex],c.classList.add("cgs-selected"),n=c.value,c=c.getAttribute("sub-value");{var[c=!1,n=!1,i=!1]=[o,c,n];let e,t;i?(c&&(e=document.querySelectorAll(`option[sub-value="${c}"]:not([value="${i}"])`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]:not([value="${i}"])`))):(c&&(e=document.querySelectorAll(`option[sub-value="${c}"]`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]`))),c&&e.forEach(e=>{e.disabled=!1}),n&&t.forEach(e=>{e.disabled=!0})}}function f(e,t){var n=e?e.target:t,t=("replaced_users"===n.name&&(e=n.id,r(null,document.getElementById(e.replace("replaced_users","substitute_users")))),n.getAttribute("sub-value"));for(const c of document.querySelectorAll(`option[sub-value="${t}"], #id_secretary option[value="${t}"]`))c.disabled=n.checked}function a(e){switch(e){case 1:document.querySelectorAll('input[name="replaced_users"]').forEach(e=>{e.addEventListener("change",n=>{if(!s(n)){{var c=n;var o=(c=c.target).parentElement;let e=null,t=null;o.nextElementSibling&&(e=o.nextElementSibling.querySelector("option"),t=o.nextElementSibling.querySelector("option[selected='selected']")),c.checked?(o.classList.add("cgs-checked"),t&&(t.selected=!0)):(o.classList.remove("cgs-checked"),e&&(e.selected=!0))}f(n)}})});break;case 2:document.querySelectorAll('input[name="unreplaced_users"]').forEach(e=>{e.addEventListener("change",e=>{s(e)||f(e)})});break;case 3:document.querySelectorAll('select[name="substitute_users"]').forEach(e=>{e.addEventListener("change",r)})}}function o(t){var n;n=function(e,o){console.log("electedUsers",o),e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):fetch("/api/v2/pages/"+t+"/").then(e=>e.json()).then(e=>{var t,n,c;e&&e.convocation_users&&(c=!!e.compte_rendu_page&&e.compte_rendu_page.secretary,t=o,n=c,(c=document.createElement("option")).textContent="---------",i.appendChild(c),t.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.name,n===e.id&&t.setAttribute("selected","selected"),i.appendChild(t)}),l(document.querySelector("#id_replaced_users"),e.convocation_users,2,o,"replaced_users"),l(document.querySelector("#id_unreplaced_users"),e.convocation_users,3,!1,"unreplaced_users"),a(1),a(2),a(3))}).catch(e=>{console.error("Erreur lors de la récupération des utilisateurs de la convocation :",e)})},fetch("/api/v2/users/?limit=10000").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{e&&e.items?(e=e.items.filter(e=>"empty"!==e.elected),console.log("filteredUsers",e),n(null,e)):n("Items not found in response",null)}).catch(e=>{n(e.message,null)})}c&&o(c),e.addEventListener("change",function(){t.innerHTML="",n.innerHTML="";var e=this.value;e&&o(e)})}document.addEventListener("DOMContentLoaded",function(){whereAmI()});