function whereAmI(){var e=document.body?document.body.getAttribute("class"):"",t=document.querySelector("header"),n=t&&t.querySelector("h1")?t.querySelector("h1").textContent:"";console.log(e),e.includes("login")&&(console.log("Page de connexion détectée"),login()),e.includes("homepage")&&(console.log("Page d'accueil du Dashboard détectée"),accueil()),document.querySelector("#id_use_map")&&(console.log("Page de l'amicale détectée"),amicale()),document.querySelector("body.ready ul.listing.cgs-quick")&&(console.log("Page quickcreate détectée"),quickcreate()),n.includes("Agents")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de FAQ détectée"),faq()),document.querySelector("#listing-results.users")&&(console.log("Page d'affichage des utilisateurs détectée"),list_users()),document.querySelector("form[action^='/admin/users/'][method='post']")&&(console.log("Création/édition d'utilisateur détectée"),edit_users_elected()),document.querySelector("form[action*='joyous/simpleeventpage/'][method='post']")&&(console.log("Création/édition d'évènement détectée"),single_event()),n.includes("Compte-rendu")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de compte-rendu détectée"),compteRendu())}function login(){var e=document.querySelector("span.cgs-eye");const t=document.getElementById("id_username"),n=document.getElementById("id_login"),c=document.getElementById("id_password"),o=(e.addEventListener("click",function(){this.classList.toggle("cgs-hidden"),this.classList.contains("cgs-hidden")?c.setAttribute("type","password"):c.setAttribute("type","text")}),document.querySelector(".form-actions div.fake")),s=document.querySelectorAll(".w-field__input input");function i(t){t.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",t.firstElementChild.style.animation="colorized 0.82s ease-in-out both",t.addEventListener("animationend",function e(){t.style.animation="",t.removeEventListener("animationend",e),t.firstElementChild.style.animation="",t.firstElementChild.removeEventListener("animationend",e)})}s.forEach(function(e){function t(e){""!==e.value?e.closest(".cgs-form-block").classList.add("cgs-input"):e.closest(".cgs-form-block").classList.remove("cgs-input"),e=Array.from(s).every(e=>""!==e.value),o.style.zIndex=e?"-1":"2"}e.addEventListener("focus",function(){this.closest(".cgs-form-block").classList.add("cgs-focus")}),e.addEventListener("blur",function(){this.closest(".cgs-form-block").classList.remove("cgs-focus")}),e.addEventListener("input",function(){t(this)}),t(e)}),o.addEventListener("click",function(){let e=!0;null===t||t.value.trim()?null===n||n.value.trim()||(i(n.closest(".cgs-form-block")),e=!1):(i(t.closest(".cgs-form-block")),e=!1),c.value.trim()||(i(c.closest(".cgs-form-block")),e=!1)})}function accueil(){document.querySelectorAll(".w-summary__list svg.icon").forEach(function(e){let t=e.nextElementSibling.getAttribute("href");e.addEventListener("click",function(){window.location.href=t})})}function amicale(){const e=document.querySelector("#id_use_map");var t;let n,c;for(t of["map_details","details_de_la_carte","detalles_del_mapa"])if(c=`panel-child-contenu-${t}-content`,n=document.querySelector("#"+c))break;const o=document.querySelector(`.w-panel__toggle[aria-controls="${c}"]`);function s(){e.checked?(o.setAttribute("aria-expanded","true"),n.classList.remove("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!1),n.removeAttribute("hidden")):(o.setAttribute("aria-expanded","false"),n.classList.add("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!0),n.setAttribute("hidden",""))}s(),e.addEventListener("change",s)}function quickcreate(){let n=[];if(document.querySelectorAll("body.ready ul.listing li a").forEach(function(e){e.innerHTML.includes("Commissions &gt;")?(n.push({href:e.getAttribute("href"),text:e.querySelector("strong").textContent}),e.parentElement.remove()):e.innerHTML=e.querySelector("strong").outerHTML}),n.length){let t='<li><a class="icon icon-plus-inverse icon-larger toggle-commissions hidden"><strong>Commissions</strong></a><ul id="commissions" class="hidden">';n.forEach(function(e){t+=`<li><a href="${e.href}">${e.text}</a></li>`}),t+="</ul></li>",document.querySelector("body.ready ul.listing").insertAdjacentHTML("beforeend",t)}document.querySelectorAll(".toggle-commissions").forEach(function(e){e.addEventListener("click",function(){document.getElementById("commissions").classList.toggle("hidden"),e.classList.toggle("hidden")})})}function faq(){document.querySelectorAll("thead th a").forEach(e=>{e.title.includes("Titre")&&(e.textContent=e.textContent+": [Thématique] - [Cibles] - [Mots-clef]")})}function list_users(){var e=document.querySelector("header .left");const n=document.createElement("select");n.id="pagination-select";const c=new URLSearchParams(window.location.search).get("paginate_by")||"20";function o(e,t,n){let c="";const o=e.split("?");var e=o[0],s=o[1];let i="";if(s){const o=s.split("&");for(let e=0;e<o.length;e++)o[e].split("=")[0]!=t&&(c+=i+o[e],i="&")}s=i+""+t+"="+n;return e+"?"+c+s}[{value:"20",text:"20"},{value:"50",text:"50"},{value:"100",text:"100"},{value:"10000",text:"Tous"}].forEach(e=>{var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.value===c&&(t.selected=!0,t.setAttribute("selected","selected")),n.appendChild(t)}),e.appendChild(n),n.addEventListener("change",function(){var e=this.value;let t;t=o(window.location.href,"paginate_by","all"===e?"":e),window.location.href=t})}function edit_users_elected(){const o=["conference","commission","council"];function t(){var e=document.querySelector("#id_function_municipality").value,t=document.querySelector("#id_function_council").value,n=document.querySelector("#id_commission").value,c=document.querySelector("#id_function_commission").options,c=(c[2].disabled="2"!==t,document.querySelector("#id_commission")),c=(["1","2","3"].includes(t)?c.classList.remove("cgs-panel-disabled"):c.classList.add("cgs-panel-disabled"),document.querySelector("#id_function_commission"));""===n?c.classList.add("cgs-panel-disabled"):c.classList.remove("cgs-panel-disabled");document.querySelector("#id_function_bureau").value="1"===t?"1":"2"===t?"2":"";var n=document.querySelector("#id_function_conference");n.value="1"===t?"1":"2"===t?"2":"1"===e?"3":"",""===e?o.forEach(e=>{document.querySelectorAll(`#${e}-content select`).forEach(e=>e.classList.add("cgs-panel-disabled"))}):["1","2","3"].includes(e)&&(c=document.querySelector("#conference-content-hidden"),n=document.querySelector("#conference-content"),["1","2"].includes(t)||"1"===e?(c.classList.add("cgs-panel-hidden"),n.classList.remove("cgs-panel-hidden")):(c.classList.remove("cgs-panel-hidden"),n.classList.add("cgs-panel-hidden")),document.querySelector("#id_function_council").classList.remove("cgs-panel-disabled")),t=document.querySelector("#id_function_municipality").value,e=document.querySelector("#id_function_council").value,""===t&&(document.querySelector("#id_function_council").value="",document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="",document.querySelector("#id_function_bureau").value="",document.querySelector("#id_function_conference").value=""),""===e&&(document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="")}document.querySelectorAll("#id_function_municipality, #id_function_council, #id_commission").forEach(e=>{e.addEventListener("change",t)}),t(),document.querySelector("#id_function_conference").classList.add("cgs-panel-disabled"),document.querySelector("#id_function_bureau").classList.add("cgs-panel-disabled")}function single_event(){var e=document.querySelector("#id_convocation"),t=e.value;function n(e){fetch("/api/v2/pages/"+e).then(e=>e.json()).then(e=>{var t,n,c=e.title.replace("Convocation ",""),o=c.charAt(0).toUpperCase()+c.slice(1),c=c.toLowerCase().replace(/ /g,"-"),o=(document.getElementById("id_title").value=o,document.getElementById("id_slug").value=c,new Date(e.date));document.getElementById("id_date").value=o.toISOString().split("T")[0],document.getElementById("id_time_from").value=o.toTimeString().split(" ")[0].substring(0,5),document.getElementById("id_location").value="Hôtel communautaire. 15, avenue du Comminges 31260 MANE",document.getElementById("id_website").value="https://cagiregaronnesalat.fr/"+c+"/",e.meta.parent.meta.logo&&(o=e.meta.parent.meta.logo,c=o,e=document.getElementById("id_image"),o=document.getElementById("id_image-chooser"),t=o.querySelector("img"),n=document.getElementById("id_image-title"),e)&&(e.value=c.id,n.innerText=c.title,t.alt=c.title,t.src=c.url,o.classList.remove("blank"))}).catch(e=>console.error("Error:",e))}t&&n(t),e.addEventListener("change",function(){var e=this.value;e&&n(e)})}function compteRendu(){var e=document.querySelector("#id_convocation");const c=document.querySelector("#id_secretary"),t=document.querySelector("#panel-child-contenu-secretary-section"),n=document.querySelector("#id_replaced_users"),s=document.querySelector("#panel-child-contenu-replaced_users-section"),o=document.querySelector("#id_unreplaced_users"),i=document.querySelector("#panel-child-contenu-unreplaced_users-section"),l=document.querySelector("#panel-child-contenu-quorum-section");c.innerHTML="",n.innerHTML="",o.innerHTML="";var r=e.value;function a(e,n){var t=document.createElement("option");t.textContent="---------",t.value="",c.appendChild(t),e.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.name,n===e.id&&t.setAttribute("selected","selected"),c.appendChild(t)})}function d(t){fetch("/api/v2/users/?limit=10000").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{e&&e.items?(e=e.items.filter(e=>e.elected),t(null,e)):t("Items not found in response",null)}).catch(e=>{t(e.message,null)})}function u(n,e,c,a,d){let u,m=[],o=[];e.forEach((s,e)=>{var t=document.createElement("div"),i=document.createElement("label"),l=(i.setAttribute("for",n.id+"_"+e),document.createElement("input"));if(l.setAttribute("type","checkbox"),l.setAttribute("name",d),l.setAttribute("value",s.id),l.setAttribute("sub-value",s.user),l.setAttribute("id",n.id+"_"+e),u=!1,s.presence===c&&(l.checked=!0,o.push(l),a)&&(i.classList.add("cgs-checked"),u=!0),i.appendChild(l),i.appendChild(document.createTextNode(" "+s.identity)),t.appendChild(i),a){let n=!1,c=!1,o=[s.id,s.user,!1];l=document.createElement("option");l.value=o;const r=document.createElement("select");r.setAttribute("name","substitute_users"),r.setAttribute("id","id_substitute_users_"+e),r.appendChild(l),a.forEach(e=>{o[2]=e.id;var t=document.createElement("option");t.value=o,t.textContent=e.name,t.setAttribute("sub-value",e.id),s.substitute===e.id&&(n&&(r.querySelector("option:selected").removeAttribute("selected"),m=m.filter(e=>e!==r.querySelector("option:selected"))),t.setAttribute("selected","selected"),m.push(t),c=!0),c||s.alternate!==e.id||(t.setAttribute("selected","selected"),m.push(t),n=!0),r.appendChild(t)});i=document.createElement("label");i.setAttribute("for","id_"+d+"_substitutes_"+e),i.appendChild(r),t.appendChild(i),n||c?u||(l.selected=!0):l.setAttribute("selected","selected")}n.appendChild(t)});for(const t of o)f(null,t);for(const s of m)p(null,s.parentElement)}function m(e){var e=e.target,t=e.name,n=e.value,t=document.querySelector("replaced_users"===t?`input[name="unreplaced_users"][value="${n}"]`:`input[name="replaced_users"][value="${n}"]`);if(t&&t.checked){{var c=e.parentElement;const o=c.parentElement;o.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",c.style.animation="colorized 0.82s ease-in-out both",o.addEventListener("animationend",()=>{o.style.animation=""}),c.addEventListener("animationend",()=>{c.style.animation=""})}return e.checked=!1,1}}function p(n,c){n=n?n.target:c,c=n.options;let o;for(const e of c)e.classList.contains("cgs-selected")&&(o=e.getAttribute("sub-value")),e.classList.remove("cgs-selected");c=c[n.selectedIndex],c.classList.add("cgs-selected"),n=c.value,c=c.getAttribute("sub-value");{var[c=!1,n=!1,s=!1]=[o,c,n];let e,t;s?(c&&(e=document.querySelectorAll(`option[sub-value="${c}"]:not([value="${s}"])`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]:not([value="${s}"])`))):(c&&(e=document.querySelectorAll(`option[sub-value="${c}"]`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]`))),c&&e.forEach(e=>{e.disabled=!1}),n&&t.forEach(e=>{e.disabled=!0})}}function f(e,t){var n=e?e.target:t,t=("replaced_users"===n.name&&(e=n.id,p(null,document.getElementById(e.replace("replaced_users","substitute_users")))),n.getAttribute("sub-value"));for(const c of document.querySelectorAll(`option[sub-value="${t}"], #id_secretary option[value="${t}"]`))c.disabled=n.checked}function g(e){switch(e){case 1:document.querySelectorAll('input[name="replaced_users"]').forEach(e=>{e.addEventListener("change",n=>{if(!m(n)){{var c=n;var o=(c=c.target).parentElement;let e=null,t=null;o.nextElementSibling&&(e=o.nextElementSibling.querySelector("option"),t=o.nextElementSibling.querySelector("option[selected='selected']")),c.checked?(o.classList.add("cgs-checked"),t&&(t.selected=!0)):(o.classList.remove("cgs-checked"),e&&(e.selected=!0))}f(n)}})});break;case 2:document.querySelectorAll('input[name="unreplaced_users"]').forEach(e=>{e.addEventListener("change",e=>{m(e)||f(e)})});break;case 3:document.querySelectorAll('select[name="substitute_users"]').forEach(e=>{e.addEventListener("change",p)})}}function h(e){fetch("/api/v2/pages/"+e+"/").then(e=>e.json()).then(n=>{var e=!!n.meta.parent&&n.meta.parent.meta.type;const c=!!n.compte_rendu_page&&n.compte_rendu_page.secretary,o=n.convocation_users||!1;if(n&&e)switch(e){case"administration.ConseilsIndexPage":console.log("Compte-rendu de conseil détecté (on affiche tout)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&(a(t,c),o)&&(u(document.querySelector("#id_replaced_users"),o,2,t,"replaced_users"),u(document.querySelector("#id_unreplaced_users"),o,3,!1,"unreplaced_users"),g(1),g(2),g(3))});break;case"administration.BureauxIndexPage":console.log("Compte-rendu de bureau détecté (on cache tout)"),t.classList.add("cgs-hidden"),s.classList.add("cgs-hidden"),i.classList.add("cgs-hidden"),l.classList.add("cgs-hidden");break;case"administration.CommissionPage":console.log("Compte-rendu de commission détecté (on n'affiche que le secrétaire de séance)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&a(t,c)}),s.classList.add("cgs-hidden"),i.classList.add("cgs-hidden"),l.classList.add("cgs-hidden");break;case"administration.ConferencesIndexPage":console.log("Compte-rendu de conférence détecté (on affiche tout sauf le secrétaire de séance)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&o&&(u(document.querySelector("#id_replaced_users"),o,2,t,"replaced_users"),u(document.querySelector("#id_unreplaced_users"),o,3,!1,"unreplaced_users"),g(1),g(2),g(3))}),t.classList.add("cgs-hidden")}}).catch(e=>{console.error("Erreur lors de la récupération des utilisateurs de la convocation :",e)})}r&&h(r),e.addEventListener("change",function(){n.innerHTML="",o.innerHTML="";var e=this.value;e&&h(e)})}document.addEventListener("DOMContentLoaded",function(){whereAmI()});