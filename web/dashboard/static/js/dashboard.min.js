function whereAmI(){var e=document.body?document.body.getAttribute("class"):"",t=document.querySelector("header"),n=t&&t.querySelector("h1")?t.querySelector("h1").textContent:"";console.log(e),e.includes("login")&&(console.log("Page de connexion d√©tect√©e"),login()),e.includes("homepage")&&(console.log("Page d'accueil du Dashboard d√©tect√©e"),accueil()),document.querySelector("#id_use_map")&&(console.log("Page de l'amicale d√©tect√©e"),amicale()),document.querySelector("body.ready ul.listing.cgs-quick")&&(console.log("Page quickcreate d√©tect√©e"),quickcreate()),n.includes("Agents")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de FAQ d√©tect√©e"),faq()),document.querySelector("#listing-results.users")&&(console.log("Page d'affichage des utilisateurs d√©tect√©e"),list_users()),document.querySelector("form[action^='/admin/users/'][method='post']")&&(console.log("Cr√©ation/√©dition d'utilisateur d√©tect√©e"),commissions_update(),edit_users_elected()),document.querySelector("form[action*='joyous/simpleeventpage/'][method='post']")&&(console.log("Cr√©ation/√©dition d'√©v√®nement d√©tect√©e"),joyous_single_event()),n.includes("Compte-rendu")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de compte-rendu d√©tect√©e"),cr_import_users(),cr_import_pdf())}function collapsible(e){e.closest(".cgs-collapsible").classList.toggle("cgs-collapsed")}function function_update(){console.log("Mise √† jour de l'input pour la liste des fonctions relative aux commissions");var e=document.querySelectorAll('input[name="commissions"]:checked');const n=[];e.forEach(e=>{var t=document.querySelector(`select[data-id="${e.value}"]`);t&&n.push({commission:e.value,function:t.value})}),document.getElementById("id_functions_commissions").value=JSON.stringify(n)}function login(){var e=document.querySelector("span.cgs-eye");const t=document.getElementById("id_username"),n=document.getElementById("id_login"),o=document.getElementById("id_password"),c=(e.addEventListener("click",function(){this.classList.toggle("showpass"),this.classList.contains("showpass")?o.setAttribute("type","password"):o.setAttribute("type","text")}),document.querySelector(".form-actions div.fake")),s=document.querySelectorAll(".w-field__input input");function i(t){t.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",t.firstElementChild.style.animation="colorized 0.82s ease-in-out both",t.addEventListener("animationend",function e(){t.style.animation="",t.removeEventListener("animationend",e),t.firstElementChild.style.animation="",t.firstElementChild.removeEventListener("animationend",e)})}s.forEach(function(e){function t(e){""!==e.value?e.closest(".cgs-form-block").classList.add("cgs-input"):e.closest(".cgs-form-block").classList.remove("cgs-input"),e=Array.from(s).every(e=>""!==e.value),c.style.zIndex=e?"-1":"2"}e.addEventListener("focus",function(){this.closest(".cgs-form-block").classList.add("cgs-focus")}),e.addEventListener("blur",function(){this.closest(".cgs-form-block").classList.remove("cgs-focus")}),e.addEventListener("input",function(){t(this)}),t(e)}),c.addEventListener("click",function(){let e=!0;null===t||t.value.trim()?null===n||n.value.trim()||(i(n.closest(".cgs-form-block")),e=!1):(i(t.closest(".cgs-form-block")),e=!1),o.value.trim()||(i(o.closest(".cgs-form-block")),e=!1)})}function accueil(){document.querySelectorAll(".w-summary__list svg.icon").forEach(function(e){let t=e.nextElementSibling.getAttribute("href");e.addEventListener("click",function(){window.location.href=t})})}function amicale(){const e=document.querySelector("#id_use_map");var t;let n,o;for(t of["map_details","details_de_la_carte","detalles_del_mapa"])if(o=`panel-child-contenu-${t}-content`,n=document.querySelector("#"+o))break;const c=document.querySelector(`.w-panel__toggle[aria-controls="${o}"]`);function s(){e.checked?(c.setAttribute("aria-expanded","true"),n.classList.remove("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!1),n.removeAttribute("hidden")):(c.setAttribute("aria-expanded","false"),n.classList.add("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!0),n.setAttribute("hidden",""))}s(),e.addEventListener("change",s)}function quickcreate(){let n=[];if(document.querySelectorAll("body.ready ul.listing li a").forEach(function(e){e.innerHTML.includes("Commissions &gt;")?(n.push({href:e.getAttribute("href"),text:e.querySelector("strong").textContent}),e.parentElement.remove()):e.innerHTML=e.querySelector("strong").outerHTML}),n.length){let t='<li><a class="icon icon-plus-inverse icon-larger toggle-commissions hidden"><strong>Commissions</strong></a><ul id="commissions" class="hidden">';n.forEach(function(e){t+=`<li><a href="${e.href}">${e.text}</a></li>`}),t+="</ul></li>",document.querySelector("body.ready ul.listing").insertAdjacentHTML("beforeend",t)}document.querySelectorAll(".toggle-commissions").forEach(function(e){e.addEventListener("click",function(){document.getElementById("commissions").classList.toggle("hidden"),e.classList.toggle("hidden")})})}function faq(){document.querySelectorAll("thead th a").forEach(e=>{e.title.includes("Titre")&&(e.textContent=e.textContent+": [Th√©matique] - [Cibles] - [Mots-clef]")})}function list_users(){var e=document.querySelector("header .left");const n=document.createElement("select");n.id="pagination-select";const o=new URLSearchParams(window.location.search).get("paginate_by")||"20";function c(e,t,n){let o="";const c=e.split("?");var e=c[0],s=c[1];let i="";if(s){const c=s.split("&");for(let e=0;e<c.length;e++)c[e].split("=")[0]!=t&&(o+=i+c[e],i="&")}s=i+""+t+"="+n;return e+"?"+o+s}[{value:"20",text:"20"},{value:"50",text:"50"},{value:"100",text:"100"},{value:"10000",text:"Tous"}].forEach(e=>{var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.value===o&&(t.selected=!0,t.setAttribute("selected","selected")),n.appendChild(t)}),e.appendChild(n),n.addEventListener("change",function(){var e=this.value;let t;t=c(window.location.href,"paginate_by","all"===e?"":e),window.location.href=t})}function commissions_update(){var e=document.getElementById("id_commissions"),t=document.getElementById("id_functions_commissions");const l=JSON.parse(t.value);var n=Array.from(e.options).sort((e,t)=>e.textContent.localeCompare(t.textContent));const a=document.createElement("div"),r=(a.setAttribute("id","id_commissions"),document.createElement("div"));r.setAttribute("id","id_functions_commissions_list");var o=e.parentElement,c=o.parentElement,s=c.parentElement,i=t.parentElement,d=i.parentElement,u=d.parentElement,m=document.getElementById("commissions-content");for(const p of m.querySelectorAll(".w-field__errors[data-field-errors]"))0<p.children.length&&(console.log("ERREUR TROUVEE"),m.insertBefore(p,m.firstChild));n.forEach((t,e)=>{var n=(l.find(({commission:e})=>e===t.value)||{})["function"],o=document.createElement("div"),c=document.createElement("div"),s=document.createElement("label"),n=function(e,t,n){var o=document.createElement("select"),e=(o.classList.add("cgs-selector"),o.setAttribute("title",e),o.setAttribute("data-id",t),document.createElement("option")),t=(e.value="",e.selected=!0,e.textContent="---------",o.appendChild(e),document.createElement("option")),e=(t.value="3",t.textContent="Membre",o.appendChild(t),document.createElement("option")),t=(e.value="1",e.textContent="Pr√©sident",o.appendChild(e),document.createElement("option"));t.value="2",t.textContent="Charg√© de commission",o.appendChild(t),void 0!==n&&(o.classList.add("cgs-checked"),o.value=n);return o}(t.textContent,t.value,n),i=document.createElement("input");s.setAttribute("for","id_commissions_"+e),i.setAttribute("id","id_commissions_"+e),i.setAttribute("type","checkbox"),i.setAttribute("name","commissions"),i.setAttribute("value",t.value),t.selected&&i.setAttribute("checked","checked"),i.addEventListener("change",function(){var e=document.querySelector(`select[data-id="${this.value}"]`);this.checked?(e.classList.add("cgs-checked"),""===e.value&&(e.value="3")):(e.classList.remove("cgs-checked"),e.value="")}),s.appendChild(i),s.appendChild(document.createTextNode(t.textContent)),o.appendChild(s),c.appendChild(n),a.appendChild(o),a.addEventListener("change",function_update),r.appendChild(c),r.addEventListener("change",function_update)}),o.replaceChild(a,e),i.replaceChild(r,t),n=r,(o=document.createElement("input")).setAttribute("type","hidden"),o.setAttribute("name","functions_commissions"),o.setAttribute("id","id_functions_commissions"),n.appendChild(o),c.className="w-field w-field--model_multiple_choice_field w-field--checkbox_select_multiple",d.className="w-field w-field--model_multiple_choice_field w-field--checkbox_select_multiple",s.removeChild(s.querySelector("label")),u.removeChild(u.querySelector("label")),function_update()}function edit_users_elected(){const t=document.querySelector("#id_municipality"),n=document.querySelector("#id_function_municipality"),o=document.querySelector("#id_function_council"),c=document.querySelector("#commissions-section"),s=document.querySelector("#id_function_bureau"),i=document.querySelector("#id_function_conference"),l=document.querySelectorAll("#id_commissions input[type='checkbox']"),a=document.querySelectorAll("#id_functions_commissions_list select"),r=document.querySelectorAll("#id_functions_commissions_list option[value='2']");function d(){function e(t){r.forEach(e=>{e.disabled=!t,t||(e.selected=!1)})}t.value?n.classList.remove("cgs-panel-disabled"):(n.classList.add("cgs-panel-disabled"),n.value=""),n.value?(o.classList.remove("cgs-panel-disabled"),c.classList.remove("cgs-panel-disabled")):(o.classList.add("cgs-panel-disabled"),c.classList.add("cgs-panel-disabled"),o.value="",s.value="",i.value="",l.forEach(e=>{e.checked=!1}),a.forEach(e=>{console.log(e),e.value="",e.classList.remove("cgs-checked")}),function_update()),"1"===o.value?(i.value="1",e(!(s.value="1"))):"2"===o.value?(i.value="2",s.value="2",e(!0)):(i.value="1"===n.value?"3":"",s.value="",e(!1))}document.querySelectorAll("#id_municipality, #id_function_municipality, #id_function_council, #id_commissions").forEach(e=>{e.addEventListener("change",d)}),n.classList.add("cgs-panel-disabled"),o.classList.add("cgs-panel-disabled"),s.classList.add("cgs-panel-disabled"),c.classList.add("cgs-panel-disabled"),i.classList.add("cgs-panel-disabled"),d()}function joyous_single_event(){var e=document.querySelector("#id_convocation"),t=e.value;function n(e){fetch("/api/v2/pages/"+e).then(e=>e.json()).then(e=>{var t,n,o=e.title.replace("Convocation ",""),c=o.charAt(0).toUpperCase()+o.slice(1),o=o.toLowerCase().replace(/ /g,"-"),c=(document.getElementById("id_title").value=c,document.getElementById("id_slug").value=o,new Date(e.date));document.getElementById("id_date").value=c.toISOString().split("T")[0],document.getElementById("id_time_from").value=c.toTimeString().split(" ")[0].substring(0,5),document.getElementById("id_location").value="H√¥tel communautaire. 15, avenue du Comminges 31260 MANE",document.getElementById("id_website").value="https://cagiregaronnesalat.fr/"+o+"/",e.meta.parent.meta.logo&&(c=e.meta.parent.meta.logo,o=c,e=document.getElementById("id_image"),c=document.getElementById("id_image-chooser"),t=c.querySelector("img"),n=document.getElementById("id_image-title"),e)&&(e.value=o.id,n.innerText=o.title,t.alt=o.title,t.src=o.url,c.classList.remove("blank"))}).catch(e=>console.error("Error:",e))}t&&n(t),e.addEventListener("change",function(){var e=this.value;e&&n(e)})}function cr_import_users(){var e=document.querySelector("#id_convocation");const o=document.querySelector("#id_secretary"),s=document.querySelector("div.instance_secretary"),i=document.querySelector("#panel-child-contenu-absence_management-section"),t=document.querySelector("#id_replaced_users"),n=document.querySelector("#id_unreplaced_users"),l=document.querySelector("div.instance_quorum"),c=document.querySelector("#panel-child-contenu-body-section"),a=document.querySelector("#panel-child-contenu-pieces_jointes-section");o.innerHTML="",t.innerHTML="",n.innerHTML="";var r=e.value;function d(e,n){var t=document.createElement("option");t.textContent="---------",t.value="",o.appendChild(t),e.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.name,n===e.id&&t.setAttribute("selected","selected"),o.appendChild(t)})}function u(t){fetch("/api/v2/users/?limit=10000").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{e&&e.items?(e=e.items.filter(e=>e.elected),t(null,e)):t("Items not found in response",null)}).catch(e=>{t(e.message,null)})}function m(n,e,o,r,d){let u,m=[],c=[];e.forEach((s,e)=>{var t=document.createElement("div"),i=document.createElement("label"),l=(i.setAttribute("for",n.id+"_"+e),document.createElement("input"));if(l.setAttribute("type","checkbox"),l.setAttribute("name",d),l.setAttribute("value",s.id),l.setAttribute("sub-value",s.user),l.setAttribute("id",n.id+"_"+e),u=!1,s.presence===o&&(l.checked=!0,c.push(l),r)&&(i.classList.add("cgs-checked"),u=!0),i.appendChild(l),i.appendChild(document.createTextNode(" "+s.identity)),t.appendChild(i),r){let n=!1,o=!1,c=[s.id,s.user,!1];l=document.createElement("option");l.value=c;const a=document.createElement("select");a.setAttribute("name","substitute_users"),a.setAttribute("id","id_substitute_users_"+e),a.appendChild(l),r.forEach(e=>{c[2]=e.id;var t=document.createElement("option");t.value=c,t.textContent=e.name,t.setAttribute("sub-value",e.id),s.substitute===e.id&&(n&&(a.querySelector("option:selected").removeAttribute("selected"),m=m.filter(e=>e!==a.querySelector("option:selected"))),t.setAttribute("selected","selected"),m.push(t),o=!0),o||s.alternate!==e.id||(t.setAttribute("selected","selected"),m.push(t),n=!0),a.appendChild(t)});i=document.createElement("label");i.setAttribute("for","id_"+d+"_substitutes_"+e),i.appendChild(a),t.appendChild(i),n||o?u||(l.selected=!0):l.setAttribute("selected","selected")}n.appendChild(t)});for(const t of c)v(null,t);for(const s of m)h(null,s.parentElement)}function p(e){var e=e.target,t=e.name,n=e.value,t=document.querySelector("replaced_users"===t?`input[name="unreplaced_users"][value="${n}"]`:`input[name="replaced_users"][value="${n}"]`);if(t&&t.checked){{var o=e.parentElement;const c=o.parentElement;c.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",o.style.animation="colorized 0.82s ease-in-out both",c.addEventListener("animationend",()=>{c.style.animation=""}),o.addEventListener("animationend",()=>{o.style.animation=""})}return e.checked=!1,1}}function h(n,o){n=n?n.target:o,o=n.options;let c;for(const e of o)e.classList.contains("cgs-selected")&&(c=e.getAttribute("sub-value")),e.classList.remove("cgs-selected");o=o[n.selectedIndex],o.classList.add("cgs-selected"),n=o.value,o=o.getAttribute("sub-value");{var[o=!1,n=!1,s=!1]=[c,o,n];let e,t;s?(o&&(e=document.querySelectorAll(`option[sub-value="${o}"]:not([value="${s}"])`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]:not([value="${s}"])`))):(o&&(e=document.querySelectorAll(`option[sub-value="${o}"]`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]`))),o&&e.forEach(e=>{e.disabled=!1}),n&&t.forEach(e=>{e.disabled=!0})}}function v(e,t){var n=e?e.target:t,t=("replaced_users"===n.name&&(e=n.id,h(null,document.getElementById(e.replace("replaced_users","substitute_users")))),n.getAttribute("sub-value"));for(const o of document.querySelectorAll(`option[sub-value="${t}"], #id_secretary option[value="${t}"]`))o.disabled=n.checked}function f(e){switch(e){case 1:document.querySelectorAll('input[name="replaced_users"]').forEach(e=>{e.addEventListener("change",n=>{if(!p(n)){{var o=n;var c=(o=o.target).parentElement;let e=null,t=null;c.nextElementSibling&&(e=c.nextElementSibling.querySelector("option"),t=c.nextElementSibling.querySelector("option[selected='selected']")),o.checked?(c.classList.add("cgs-checked"),t&&(t.selected=!0)):(c.classList.remove("cgs-checked"),e&&(e.selected=!0))}v(n)}})});break;case 2:document.querySelectorAll('input[name="unreplaced_users"]').forEach(e=>{e.addEventListener("change",e=>{p(e)||v(e)})});break;case 3:document.querySelectorAll('select[name="substitute_users"]').forEach(e=>{e.addEventListener("change",h)})}}function g(e){fetch("/api/v2/pages/"+e+"/").then(e=>e.json()).then(n=>{console.log(n);const o=n.convocation_users||!1;if(o&&2===o[0].user)throw new Error("Ancienne convocation d√©tect√©e");var e=!!n.meta.parent&&n.meta.parent.meta.type;const c=!!n.compte_rendu_page&&n.compte_rendu_page.secretary;if(n&&e)switch(e){case"administration.ConseilsIndexPage":console.log("Compte-rendu de conseil d√©tect√© (on affiche tout)"),u(function(e,t){e?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",e):n&&(d(t,c),o)&&(m(document.querySelector("#id_replaced_users"),o,2,t,"replaced_users"),m(document.querySelector("#id_unreplaced_users"),o,3,!1,"unreplaced_users"),f(1),f(2),f(3))});break;case"administration.BureauxIndexPage":console.log("Compte-rendu de bureau d√©tect√© (on cache tout)");break;case"administration.CommissionPage":console.log("Compte-rendu de commission d√©tect√© (on n'affiche que le secr√©taire de s√©ance)"),u(function(e,t){e?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",e):n&&d(t,c)}),i.classList.add("cgs-hidden"),l.classList.add("cgs-hidden");break;case"administration.ConferencesIndexPage":console.log("Compte-rendu de conf√©rence d√©tect√© (on affiche tout sauf le secr√©taire de s√©ance)"),u(function(e,t){e?console.error("Erreur lors de la r√©cup√©ration de la liste des utilisateurs :",e):n&&o&&(m(document.querySelector("#id_replaced_users"),o,2,t,"replaced_users"),m(document.querySelector("#id_unreplaced_users"),o,3,!1,"unreplaced_users"),f(1),f(2),f(3))}),s.classList.add("cgs-hidden")}}).catch(e=>{var t,n,o;"Ancienne convocation d√©tect√©e"===e.message?(console.log(e.message),s.classList.add("cgs-hidden"),i.classList.add("cgs-hidden"),l.classList.add("cgs-hidden"),c.classList.add("cgs-hidden"),t="Cette page est li√©e √† une ancienne convocation. Ajoutez simplement le compte-rendu en pi√®ce jointe üîó (format PDF).",(n=document.createElement("div")).classList.add("cgs-warning"),(o=document.createElement("p")).classList.add("warning-message"),o.textContent=t,n.appendChild(o),t=n,console.log(a.firstChild.nextSibling),a.insertBefore(t,a.firstChild.nextSibling)):console.error("Erreur lors de la r√©cup√©ration des utilisateurs de la convocation :",e)})}r&&g(r),e.addEventListener("change",function(){t.innerHTML="",n.innerHTML="";var e=this.value;e&&g(e)})}function cr_import_pdf(){const n=document.querySelector("#panel-child-contenu-body-content [data-streamfield-stream-container]");var e=n.querySelectorAll(":scope > [data-contentpath]");Array.from(e).filter(e=>e.querySelector('input[type="hidden"][value="PDF"]')||e.querySelector('input[type="hidden"][value="DOCX"]')).forEach(e=>{e.dataset.observed=!0});const u=new IntersectionObserver(e=>{e.forEach(e=>{var t,n,e=e.target;if(e.dataset.contentpath&&(e.querySelector('input[type="hidden"][value="PDF"]')||e.querySelector('input[type="hidden"][value="DOCX"]'))){t=(t=e).querySelector('[data-contentpath="pdf_import"]')||t.querySelector('[data-contentpath="docx_import"]'),n=t.parentElement,t=t.dataset.contentpath.split("_")[0];{var o=n;var c=t;o.classList.add("cgs-colbox"),o.querySelector(`[data-contentpath="${c}_document"]`).classList.add("cgs-col8"),o.querySelector(`[data-contentpath="${c}_import"]`).classList.add("cgs-col4");const s=o.querySelector('[data-contentpath="pdf_images"]')||o.querySelector('[data-contentpath="docx_content"]'),i=(s.classList.add("cgs-col12","cgs-collapsible","cgs-collapsed"),s.querySelector("label"));console.log(i),i.addEventListener("click",()=>collapsible(i))}{c=n;o=t;const l=c.querySelector(`[id^="body-"][id$="-value-${o}_import"]`),a=document.querySelector('form#page-edit-form footer nav button[type="submit"].action-save'),r=a.cloneNode(!0);if(r){r.removeChild(r.querySelector("svg.button-longrunning__icon")),r.classList.add("cgs-import"),r.dataset.wProgressLabelValue="Importer le "+o,r.dataset.wProgressActiveValue="Importation‚Ä¶";const d=l.cloneNode(!0);l.replaceWith(r),r.addEventListener("click",function(e){e.preventDefault();e=r.closest("form");e?(d.value="on",d.type="hidden",e.appendChild(d),e.submit()):console.log("Formulaire non trouv√©")})}}u.unobserve(e)}})},{threshold:0});var t=n.children;for(let e=0;e<t.length;e++)u.observe(t[e]);new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.length){var t=n.querySelectorAll(":scope > *:not([data-observed])");for(let e=0;e<t.length;e++)t[e].dataset.observed=!0,u.observe(t[e])}})}).observe(n,{childList:!0})}document.addEventListener("DOMContentLoaded",function(){whereAmI()});