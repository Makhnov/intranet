function whereAmI(){var e=document.body?document.body.getAttribute("class"):"",t=document.querySelector("header"),n=t&&t.querySelector("h1")?t.querySelector("h1").textContent:"";console.log(e),e.includes("login")&&(console.log("Page de connexion détectée"),login()),e.includes("homepage")&&(console.log("Page d'accueil du Dashboard détectée"),accueil()),document.querySelector("#id_use_map")&&(console.log("Page de l'amicale détectée"),amicale()),document.querySelector("body.ready ul.listing.cgs-quick")&&(console.log("Page quickcreate détectée"),quickcreate()),n.includes("Agents")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de FAQ détectée"),faq()),document.querySelector("#listing-results.users")&&(console.log("Page d'affichage des utilisateurs détectée"),list_users()),document.querySelector("form[action^='/admin/users/'][method='post']")&&(console.log("Création/édition d'utilisateur détectée"),edit_users_elected()),document.querySelector("form[action*='joyous/simpleeventpage/'][method='post']")&&(console.log("Création/édition d'évènement détectée"),joyous_single_event()),n.includes("Compte-rendu")&&t.closest("header").classList.contains("w-slim-header")&&(console.log("Page de compte-rendu détectée"),cr_import_users(),cr_import_pdf())}function collapsible(e){e.closest(".cgs-collapsible").classList.toggle("cgs-collapsed")}function login(){var e=document.querySelector("span.cgs-eye");const t=document.getElementById("id_username"),n=document.getElementById("id_login"),o=document.getElementById("id_password"),c=(e.addEventListener("click",function(){this.classList.toggle("cgs-hidden"),this.classList.contains("cgs-hidden")?o.setAttribute("type","password"):o.setAttribute("type","text")}),document.querySelector(".form-actions div.fake")),s=document.querySelectorAll(".w-field__input input");function l(t){t.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",t.firstElementChild.style.animation="colorized 0.82s ease-in-out both",t.addEventListener("animationend",function e(){t.style.animation="",t.removeEventListener("animationend",e),t.firstElementChild.style.animation="",t.firstElementChild.removeEventListener("animationend",e)})}s.forEach(function(e){function t(e){""!==e.value?e.closest(".cgs-form-block").classList.add("cgs-input"):e.closest(".cgs-form-block").classList.remove("cgs-input"),e=Array.from(s).every(e=>""!==e.value),c.style.zIndex=e?"-1":"2"}e.addEventListener("focus",function(){this.closest(".cgs-form-block").classList.add("cgs-focus")}),e.addEventListener("blur",function(){this.closest(".cgs-form-block").classList.remove("cgs-focus")}),e.addEventListener("input",function(){t(this)}),t(e)}),c.addEventListener("click",function(){let e=!0;null===t||t.value.trim()?null===n||n.value.trim()||(l(n.closest(".cgs-form-block")),e=!1):(l(t.closest(".cgs-form-block")),e=!1),o.value.trim()||(l(o.closest(".cgs-form-block")),e=!1)})}function accueil(){document.querySelectorAll(".w-summary__list svg.icon").forEach(function(e){let t=e.nextElementSibling.getAttribute("href");e.addEventListener("click",function(){window.location.href=t})})}function amicale(){const e=document.querySelector("#id_use_map");var t;let n,o;for(t of["map_details","details_de_la_carte","detalles_del_mapa"])if(o=`panel-child-contenu-${t}-content`,n=document.querySelector("#"+o))break;const c=document.querySelector(`.w-panel__toggle[aria-controls="${o}"]`);function s(){e.checked?(c.setAttribute("aria-expanded","true"),n.classList.remove("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!1),n.removeAttribute("hidden")):(c.setAttribute("aria-expanded","false"),n.classList.add("disabled"),n.querySelectorAll("input, select, textarea").forEach(e=>e.disabled=!0),n.setAttribute("hidden",""))}s(),e.addEventListener("change",s)}function quickcreate(){let n=[];if(document.querySelectorAll("body.ready ul.listing li a").forEach(function(e){e.innerHTML.includes("Commissions &gt;")?(n.push({href:e.getAttribute("href"),text:e.querySelector("strong").textContent}),e.parentElement.remove()):e.innerHTML=e.querySelector("strong").outerHTML}),n.length){let t='<li><a class="icon icon-plus-inverse icon-larger toggle-commissions hidden"><strong>Commissions</strong></a><ul id="commissions" class="hidden">';n.forEach(function(e){t+=`<li><a href="${e.href}">${e.text}</a></li>`}),t+="</ul></li>",document.querySelector("body.ready ul.listing").insertAdjacentHTML("beforeend",t)}document.querySelectorAll(".toggle-commissions").forEach(function(e){e.addEventListener("click",function(){document.getElementById("commissions").classList.toggle("hidden"),e.classList.toggle("hidden")})})}function faq(){document.querySelectorAll("thead th a").forEach(e=>{e.title.includes("Titre")&&(e.textContent=e.textContent+": [Thématique] - [Cibles] - [Mots-clef]")})}function list_users(){var e=document.querySelector("header .left");const n=document.createElement("select");n.id="pagination-select";const o=new URLSearchParams(window.location.search).get("paginate_by")||"20";function c(e,t,n){let o="";const c=e.split("?");var e=c[0],s=c[1];let l="";if(s){const c=s.split("&");for(let e=0;e<c.length;e++)c[e].split("=")[0]!=t&&(o+=l+c[e],l="&")}s=l+""+t+"="+n;return e+"?"+o+s}[{value:"20",text:"20"},{value:"50",text:"50"},{value:"100",text:"100"},{value:"10000",text:"Tous"}].forEach(e=>{var t=document.createElement("option");t.value=e.value,t.textContent=e.text,e.value===o&&(t.selected=!0,t.setAttribute("selected","selected")),n.appendChild(t)}),e.appendChild(n),n.addEventListener("change",function(){var e=this.value;let t;t=c(window.location.href,"paginate_by","all"===e?"":e),window.location.href=t})}function edit_users_elected(){const c=["conference","commission","council"];function t(){var e=document.querySelector("#id_function_municipality").value,t=document.querySelector("#id_function_council").value,n=document.querySelector("#id_commission").value,o=document.querySelector("#id_function_commission").options,o=(o[2].disabled="2"!==t,document.querySelector("#id_commission")),o=(["1","2","3"].includes(t)?o.classList.remove("cgs-panel-disabled"):o.classList.add("cgs-panel-disabled"),document.querySelector("#id_function_commission"));""===n?o.classList.add("cgs-panel-disabled"):o.classList.remove("cgs-panel-disabled");document.querySelector("#id_function_bureau").value="1"===t?"1":"2"===t?"2":"";var n=document.querySelector("#id_function_conference");n.value="1"===t?"1":"2"===t?"2":"1"===e?"3":"",""===e?c.forEach(e=>{document.querySelectorAll(`#${e}-content select`).forEach(e=>e.classList.add("cgs-panel-disabled"))}):["1","2","3"].includes(e)&&(o=document.querySelector("#conference-content-hidden"),n=document.querySelector("#conference-content"),["1","2"].includes(t)||"1"===e?(o.classList.add("cgs-panel-hidden"),n.classList.remove("cgs-panel-hidden")):(o.classList.remove("cgs-panel-hidden"),n.classList.add("cgs-panel-hidden")),document.querySelector("#id_function_council").classList.remove("cgs-panel-disabled")),t=document.querySelector("#id_function_municipality").value,e=document.querySelector("#id_function_council").value,""===t&&(document.querySelector("#id_function_council").value="",document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="",document.querySelector("#id_function_bureau").value="",document.querySelector("#id_function_conference").value=""),""===e&&(document.querySelector("#id_commission").value="",document.querySelector("#id_function_commission").value="")}document.querySelectorAll("#id_function_municipality, #id_function_council, #id_commission").forEach(e=>{e.addEventListener("change",t)}),t(),document.querySelector("#id_function_conference").classList.add("cgs-panel-disabled"),document.querySelector("#id_function_bureau").classList.add("cgs-panel-disabled")}function joyous_single_event(){var e=document.querySelector("#id_convocation"),t=e.value;function n(e){fetch("/api/v2/pages/"+e).then(e=>e.json()).then(e=>{var t,n,o=e.title.replace("Convocation ",""),c=o.charAt(0).toUpperCase()+o.slice(1),o=o.toLowerCase().replace(/ /g,"-"),c=(document.getElementById("id_title").value=c,document.getElementById("id_slug").value=o,new Date(e.date));document.getElementById("id_date").value=c.toISOString().split("T")[0],document.getElementById("id_time_from").value=c.toTimeString().split(" ")[0].substring(0,5),document.getElementById("id_location").value="Hôtel communautaire. 15, avenue du Comminges 31260 MANE",document.getElementById("id_website").value="https://cagiregaronnesalat.fr/"+o+"/",e.meta.parent.meta.logo&&(c=e.meta.parent.meta.logo,o=c,e=document.getElementById("id_image"),c=document.getElementById("id_image-chooser"),t=c.querySelector("img"),n=document.getElementById("id_image-title"),e)&&(e.value=o.id,n.innerText=o.title,t.alt=o.title,t.src=o.url,c.classList.remove("blank"))}).catch(e=>console.error("Error:",e))}t&&n(t),e.addEventListener("change",function(){var e=this.value;e&&n(e)})}function cr_import_users(){var e=document.querySelector("#id_convocation");const o=document.querySelector("#id_secretary"),t=document.querySelector("#panel-child-contenu-secretary-section"),n=document.querySelector("#id_replaced_users"),s=document.querySelector("#panel-child-contenu-replaced_users-section"),c=document.querySelector("#id_unreplaced_users"),l=document.querySelector("#panel-child-contenu-unreplaced_users-section"),i=document.querySelector("#panel-child-contenu-quorum-section");o.innerHTML="",n.innerHTML="",c.innerHTML="";var r=e.value;function a(e,n){var t=document.createElement("option");t.textContent="---------",t.value="",o.appendChild(t),e.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.name,n===e.id&&t.setAttribute("selected","selected"),o.appendChild(t)})}function d(t){fetch("/api/v2/users/?limit=10000").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{e&&e.items?(e=e.items.filter(e=>e.elected),t(null,e)):t("Items not found in response",null)}).catch(e=>{t(e.message,null)})}function u(n,e,o,a,d){let u,m=[],c=[];e.forEach((s,e)=>{var t=document.createElement("div"),l=document.createElement("label"),i=(l.setAttribute("for",n.id+"_"+e),document.createElement("input"));if(i.setAttribute("type","checkbox"),i.setAttribute("name",d),i.setAttribute("value",s.id),i.setAttribute("sub-value",s.user),i.setAttribute("id",n.id+"_"+e),u=!1,s.presence===o&&(i.checked=!0,c.push(i),a)&&(l.classList.add("cgs-checked"),u=!0),l.appendChild(i),l.appendChild(document.createTextNode(" "+s.identity)),t.appendChild(l),a){let n=!1,o=!1,c=[s.id,s.user,!1];i=document.createElement("option");i.value=c;const r=document.createElement("select");r.setAttribute("name","substitute_users"),r.setAttribute("id","id_substitute_users_"+e),r.appendChild(i),a.forEach(e=>{c[2]=e.id;var t=document.createElement("option");t.value=c,t.textContent=e.name,t.setAttribute("sub-value",e.id),s.substitute===e.id&&(n&&(r.querySelector("option:selected").removeAttribute("selected"),m=m.filter(e=>e!==r.querySelector("option:selected"))),t.setAttribute("selected","selected"),m.push(t),o=!0),o||s.alternate!==e.id||(t.setAttribute("selected","selected"),m.push(t),n=!0),r.appendChild(t)});l=document.createElement("label");l.setAttribute("for","id_"+d+"_substitutes_"+e),l.appendChild(r),t.appendChild(l),n||o?u||(i.selected=!0):i.setAttribute("selected","selected")}n.appendChild(t)});for(const t of c)f(null,t);for(const s of m)p(null,s.parentElement)}function m(e){var e=e.target,t=e.name,n=e.value,t=document.querySelector("replaced_users"===t?`input[name="unreplaced_users"][value="${n}"]`:`input[name="replaced_users"][value="${n}"]`);if(t&&t.checked){{var o=e.parentElement;const c=o.parentElement;c.style.animation="shake 0.82s cubic-bezier(.36,.07,.19,.97) both",o.style.animation="colorized 0.82s ease-in-out both",c.addEventListener("animationend",()=>{c.style.animation=""}),o.addEventListener("animationend",()=>{o.style.animation=""})}return e.checked=!1,1}}function p(n,o){n=n?n.target:o,o=n.options;let c;for(const e of o)e.classList.contains("cgs-selected")&&(c=e.getAttribute("sub-value")),e.classList.remove("cgs-selected");o=o[n.selectedIndex],o.classList.add("cgs-selected"),n=o.value,o=o.getAttribute("sub-value");{var[o=!1,n=!1,s=!1]=[c,o,n];let e,t;s?(o&&(e=document.querySelectorAll(`option[sub-value="${o}"]:not([value="${s}"])`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]:not([value="${s}"])`))):(o&&(e=document.querySelectorAll(`option[sub-value="${o}"]`)),n&&(t=document.querySelectorAll(`option[sub-value="${n}"]`))),o&&e.forEach(e=>{e.disabled=!1}),n&&t.forEach(e=>{e.disabled=!0})}}function f(e,t){var n=e?e.target:t,t=("replaced_users"===n.name&&(e=n.id,p(null,document.getElementById(e.replace("replaced_users","substitute_users")))),n.getAttribute("sub-value"));for(const o of document.querySelectorAll(`option[sub-value="${t}"], #id_secretary option[value="${t}"]`))o.disabled=n.checked}function g(e){switch(e){case 1:document.querySelectorAll('input[name="replaced_users"]').forEach(e=>{e.addEventListener("change",n=>{if(!m(n)){{var o=n;var c=(o=o.target).parentElement;let e=null,t=null;c.nextElementSibling&&(e=c.nextElementSibling.querySelector("option"),t=c.nextElementSibling.querySelector("option[selected='selected']")),o.checked?(c.classList.add("cgs-checked"),t&&(t.selected=!0)):(c.classList.remove("cgs-checked"),e&&(e.selected=!0))}f(n)}})});break;case 2:document.querySelectorAll('input[name="unreplaced_users"]').forEach(e=>{e.addEventListener("change",e=>{m(e)||f(e)})});break;case 3:document.querySelectorAll('select[name="substitute_users"]').forEach(e=>{e.addEventListener("change",p)})}}function h(e){fetch("/api/v2/pages/"+e+"/").then(e=>e.json()).then(n=>{var e=!!n.meta.parent&&n.meta.parent.meta.type;const o=!!n.compte_rendu_page&&n.compte_rendu_page.secretary,c=n.convocation_users||!1;if(n&&e)switch(e){case"administration.ConseilsIndexPage":console.log("Compte-rendu de conseil détecté (on affiche tout)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&(a(t,o),c)&&(u(document.querySelector("#id_replaced_users"),c,2,t,"replaced_users"),u(document.querySelector("#id_unreplaced_users"),c,3,!1,"unreplaced_users"),g(1),g(2),g(3))});break;case"administration.BureauxIndexPage":console.log("Compte-rendu de bureau détecté (on cache tout)"),t.classList.add("cgs-hidden"),s.classList.add("cgs-hidden"),l.classList.add("cgs-hidden"),i.classList.add("cgs-hidden");break;case"administration.CommissionPage":console.log("Compte-rendu de commission détecté (on n'affiche que le secrétaire de séance)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&a(t,o)}),s.classList.add("cgs-hidden"),l.classList.add("cgs-hidden"),i.classList.add("cgs-hidden");break;case"administration.ConferencesIndexPage":console.log("Compte-rendu de conférence détecté (on affiche tout sauf le secrétaire de séance)"),d(function(e,t){e?console.error("Erreur lors de la récupération de la liste des utilisateurs :",e):n&&c&&(u(document.querySelector("#id_replaced_users"),c,2,t,"replaced_users"),u(document.querySelector("#id_unreplaced_users"),c,3,!1,"unreplaced_users"),g(1),g(2),g(3))}),t.classList.add("cgs-hidden")}}).catch(e=>{console.error("Erreur lors de la récupération des utilisateurs de la convocation :",e)})}r&&h(r),e.addEventListener("change",function(){n.innerHTML="",c.innerHTML="";var e=this.value;e&&h(e)})}function cr_import_pdf(){const n=document.querySelector("#panel-child-contenu-body-content [data-streamfield-stream-container]");var e=n.querySelectorAll(":scope > [data-contentpath]");Array.from(e).filter(e=>e.querySelector('input[type="hidden"][value="PDF"]')||e.querySelector('input[type="hidden"][value="DOCX"]')).forEach(e=>{e.dataset.observed=!0});const u=new IntersectionObserver(e=>{e.forEach(e=>{var t,n,e=e.target;if(e.dataset.contentpath&&(e.querySelector('input[type="hidden"][value="PDF"]')||e.querySelector('input[type="hidden"][value="DOCX"]'))){t=(t=e).querySelector('[data-contentpath="pdf_import"]')||t.querySelector('[data-contentpath="docx_import"]'),n=t.parentElement,t=t.dataset.contentpath.split("_")[0];{var o=n;var c=t;o.classList.add("cgs-colbox"),o.querySelector(`[data-contentpath="${c}_document"]`).classList.add("cgs-col8"),o.querySelector(`[data-contentpath="${c}_import"]`).classList.add("cgs-col4");const s=o.querySelector('[data-contentpath="pdf_images"]')||o.querySelector('[data-contentpath="docx_content"]'),l=(s.classList.add("cgs-col12","cgs-collapsible","cgs-collapsed"),s.querySelector("label"));console.log(l),l.addEventListener("click",()=>collapsible(l))}{c=n;o=t;const i=c.querySelector(`[id^="body-"][id$="-value-${o}_import"]`),r=document.querySelector('form#page-edit-form footer nav button[type="submit"].action-save'),a=r.cloneNode(!0);if(a){a.removeChild(a.querySelector("svg.button-longrunning__icon")),a.classList.add("cgs-import"),a.dataset.wProgressLabelValue="Importer le "+o,a.dataset.wProgressActiveValue="Importation…";const d=i.cloneNode(!0);i.replaceWith(a),a.addEventListener("click",function(e){e.preventDefault();e=a.closest("form");e?(d.value="on",d.type="hidden",e.appendChild(d),e.submit()):console.log("Formulaire non trouvé")})}}u.unobserve(e)}})},{threshold:0});var t=n.children;for(let e=0;e<t.length;e++)u.observe(t[e]);new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.length){var t=n.querySelectorAll(":scope > *:not([data-observed])");for(let e=0;e<t.length;e++)t[e].dataset.observed=!0,u.observe(t[e])}})}).observe(n,{childList:!0})}document.addEventListener("DOMContentLoaded",function(){whereAmI()});