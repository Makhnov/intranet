function cgsMenu(){console.log("Menu chargé")}function cgsList(){console.log("Liste chargée");function e(){const e=document.querySelectorAll("#emailsContainer .email"),t=Array.from(e).map((e=>e.textContent.trim())).join(", ");navigator.clipboard.writeText(t).then((function(){console.log("Copie réussie")}),(function(e){console.error("Erreur lors de la copie",e)}))}document.getElementById("action-buttons")&&function(){const t=document.getElementById("cgs-copy");document.getElementById("cgs-download"),document.getElementById("cgs-print");t&&t.addEventListener("click",e)}()}function cgsDoc(){console.log("Document chargé")}function cgsViewer(e){console.time("Chargement du PDF"),console.time("Préchargement"),console.time("Chargement initial");const t=/Mobi/i.test(navigator.userAgent);console.log(t?"Appareil mobile détecté":"Grand écran détecté");let n={},o=0,s=0,c=1,r=1;const i=new IntersectionObserver((e=>{e.forEach((e=>{const t=parseInt(e.target.getAttribute("data-page"));e.isIntersecting&&!n[t]?.rendered&&(!async function(e){if(console.time(`Rendu de la page ${e}`),!n[e]||n[e].rendering)return;o+=1,n[e].rendering=!0;const{page:t,viewport:c,placeholder:r}=n[e];let i={canvasContext:r.getContext("2d"),viewport:c};try{await t.render(i).promise,r.closest("div").classList.remove("cgs-placeholder"),n[e].rendered=!0,console.log(`Page ${e} rendue`),s+=1}catch(t){console.error(`Erreur lors du rendu de la page ${e}:`,t)}finally{o-=1,n[e].rendering=!1,function(){let e=Object.keys(n).length,t=s/e*100;document.documentElement.style.setProperty("--progress",`${t}%`),l.textContent=`${Math.round(t)}%`}()}console.timeEnd(`Rendu de la page ${e}`)}(t),n[t].rendered=!0)}))}),{root:e,threshold:.1}),a=document.getElementById("spinner_svg"),l=document.querySelector("div.cgs-progress p.progress-value");async function d(e,o,s){const c=await e.getPage(o),r=t?window.devicePixelRatio:Math.max(window.devicePixelRatio||1,3),l=c.getViewport({scale:r}),d=document.createElement("div");d.classList.add("cgs-page"),d.setAttribute("data-page",o),d.setAttribute("id",`block-${o}`),d.classList.add("cgs-placeholder");let u=document.createElement("canvas");u.width=l.width,u.height=l.height,u.setAttribute("id",`page-${o}`),d.appendChild(u),d.appendChild(a.cloneNode(!0)),s.appendChild(d),i.observe(d),n[o]={page:c,viewport:l,placeholder:u,rendered:!1}}function u(t){const n=document.querySelector("nav.viewer");if(!n)return void console.error("Container de navigation non trouvé");const o=n.querySelector("input");o.max=t;n.querySelector("span.max-page").textContent=t;const s=e.querySelectorAll("canvas"),r=s[0].offsetWidth;let i=r;const a=document.getElementById("first-page"),l=document.getElementById("next-page"),d=document.getElementById("last-page"),u=document.getElementById("prev-page"),g=document.getElementById("zoom-in"),m=document.getElementById("zoom-out"),p=document.getElementById("fullscreen"),h=p.querySelector("button");function y(t){const n=document.getElementById(`page-${t}`);if(n){e.scrollTop;const t=n.offsetTop-e.offsetTop;return n.scrollIntoView({behavior:"smooth",block:"start"}),console.log("Position attendue après défilement : "+t),t}}function v(t){const n=h.querySelector(".expand"),o=h.querySelector(".compress");h.expanded=t,t?(e.style.setProperty("--canvas-max-width","100%"),e.style.setProperty("--canvas-max-height","none"),e.style.setProperty("--canvas-width","initial"),e.style.justifyContent="center",i=r,n.classList.add("cgs-hidden"),o.classList.remove("cgs-hidden"),h.setAttribute("title","Quitter le mode plein écran"),h.setAttribute("alt","Quitter le mode plein écran")):(e.style.setProperty("--canvas-max-width","100%"),e.style.setProperty("--canvas-max-height","calc(100vh - (var(--header-height) + var(--footer-height) + var(--header-padding)))"),e.style.setProperty("--canvas-width","initial"),e.style.justifyContent="center",i=r,n.classList.remove("cgs-hidden"),o.classList.add("cgs-hidden"),h.setAttribute("title","Passer en mode plein écran"),h.setAttribute("alt","Passer en mode plein écran"))}function f(){console.log("currentWidth : "+i),console.log("container width : "+e.offsetWidth),i>e.offsetWidth?(e.style.justifyContent="flex-start",e.style.overflowX="scroll"):(e.style.justifyContent="center",e.style.overflowX="initial"),e.style.setProperty("--canvas-width",`${i}px`),e.style.setProperty("--canvas-max-height","none"),e.style.setProperty("--canvas-max-width","none")}a.addEventListener("click",(()=>{if(1!=c){c=1,o.value=c;const e=y(c);console.log(e)}})),u.addEventListener("click",(()=>{if(c>1){c--,o.value=c;const e=y(c);console.log(e)}})),d.addEventListener("click",(()=>{if(c!=t){c=t,o.value=c;const e=y(c);console.log(e)}})),l.addEventListener("click",(()=>{if(c<t){c++,o.value=c;const e=y(c);console.log(e)}})),o.addEventListener("change",(()=>{const e=parseInt(o.value);if(!isNaN(e)&&e>=1&&e<=o.max){c=e;const t=y(c);console.log(t)}else o.value=c})),p.addEventListener("click",(()=>{h.expanded?v(!1):v(!0)})),g.addEventListener("click",(()=>{i*=1.1,i>s[0].width&&(i=s[0].width),f()})),m.addEventListener("click",(()=>{i*=.9,i<350&&(i=350),f()}))}!async function(e){const t=e.getAttribute("data-url");if(!t)return void console.error("URL du PDF non définie");console.log("URL du PDF : "+t);try{const n=await pdfjsLib.getDocument(t).promise;r=n.numPages,console.timeEnd("Chargement du PDF");for(let t=1;t<=r;t++)await d(n,t,e);u(r),console.timeEnd("Préchargement")}catch(e){console.error(e)}}(e)}document.addEventListener("DOMContentLoaded",(function(){console.log("Page d'administration chargée");const e=document.body?document.body.getAttribute("class"):"";if(e.includes("menu")&&cgsMenu(),e.includes("list")&&cgsList(),e.includes("doc")){cgsDoc();const e=document.getElementById("viewer");e&&cgsViewer(e)}}));