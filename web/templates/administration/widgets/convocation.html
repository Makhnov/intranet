{% load wagtailcore_tags wagtailimages_tags wagtailroutablepage_tags %}

{% block content %}
    <main class="main-content">
    {% comment %} Convocation pre-intranet (Pièces-jointes uniquement) {% endcomment %}
        {% if old %}
            {% for document in page.convocation_documents.all %}
                {% with doc=document.document %}
                    {% if doc %}
                        <div id="viewer" alt="{% if doc.title %}{{ doc.title }}{% else %}{{ doc }}{% endif %}" data-url="{{doc.url}}">            
                            {% comment %} Fichier administration_convocation.js {% endcomment %}                            
                        </div>
                    {% endif %}
                {% endwith %}
            {% endfor %}
        {% comment %} Convocation post-intranet (Document au complet) {% endcomment %}
        {% else %}
            <div class="container-fluid">
                {% if is_pdf %}
                    {% comment %} Watermark {% endcomment %}
                    {% if settings.dashboard.PDFSettings.watermark %}
                        {% image settings.dashboard.PDFSettings.watermark original class="watermark" alt="Watermark" %}
                    {% endif %}
            
                    {% comment %} Logo {% endcomment %}
                    {% if settings.dashboard.PDFSettings.logo %}
                        {% image settings.dashboard.PDFSettings.logo original class="logo" alt="Logo" %}
                    {% endif %}
                {% endif %}

                <div class="grid-item grid-invitation">                
                    <div class="grid-invitation-content">
                        {% if hosts %}
                            <div>
                                {% if hosts|length == 1 %}
                                    {% for host in hosts %}
                                        <p>{{ host.civility }} {{ host.name }}, {{ host.function }}</p>
                                    {% endfor %}
                                {% else %}
                                    {% for host in hosts %}
                                        {% if forloop.last and not forloop.first %}
                                            <p>et {{ host.civility }} {{ host.name }}, {{ host.function }}<p>
                                        {% else %}
                                            <p>{{ host.civility }} {{ host.name }}, {{ host.function }}{% if not forloop.last %},{% endif %}<p>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        {% endif %}
                        <div><p>A</p></div>
                        <p>Mesdames, Messieurs les</p>
                        {% if sub_dir == "bureaux" %}
                            <p>Vice présidents, </p>
                            <p>Membres du bureau</p>
                        {% elif sub_dir == "commissions" %}
                            <p>membres de la commission</p>
                            <p>{{ parent }}</p>
                        {% elif sub_dir == "conferences" %}
                            <p>Maires</p>
                        {% elif sub_dir == "conseils" %}
                            <p>délégués communautaires et</p>
                            <p>délégués suppléants</p>
                        {% endif %}

                    </div>
                </div>
                
                <div class="grid-item grid-informations">
                    <p>{{ settings.dashboard.PDFSettings.locality }}</p>
                    <p>Le {{ page.latest_revision_created_at|date:"l d F Y" }}</p>
                </div>

                <div class="grid-item grid-opening">
                    <p>{{ settings.dashboard.PDFSettings.opening_councils|linebreaksbr }}</p>
                </div>

                <div class="grid-item grid-rdv">
                    <p>
                        {{ page.date|date:"l d F Y" }} à {{ page.date|date:"H" }} heure{% if page.date|date:"H"|add:"0" > 1 %}s{% endif %} {{ page.date|date:"i" }}
                        
                    </p>        
                    <p>{{ settings.dashboard.PDFSettings.locality_description }}</p>
                </div>

                <div class="grid-item grid-odj">
                    <p>A l’ordre du jour sont inscrits les points suivants :</p>
                    <p>{{ page.body|richtext }}</p>
                </div>
                
                <div class="grid-item grid-closing">
                    <p>{{ settings.dashboard.PDFSettings.closing_councils }}</p>
                </div>

                <div class="grid-item grid-signature">
                    {% if hosts %}
                        {% if hosts|length == 1 %}
                            {% for host in hosts %}
                                {{ host.civility }} {{ host.name }}, {{ host.function }}
                            {% endfor %}
                        {% else %}
                            {% for host in hosts %}
                                {% if forloop.last and not forloop.first %}
                                    et {{ host.civility }} {{ host.name }}, {{ host.function }}
                                {% else %}
                                    {{ host.civility }} {{ host.name }}, {{ host.function }}{% if not forloop.last %};{% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endif %}
                </div>

                <div class="grid-item grid-documents">
                    <h3>Documents associés :</h3>
                    <ul>
                    {% for piece_jointe in page.convocation_documents.all %}
                        {% if piece_jointe.document %}
                            <span>
                                <a href="{{ piece_jointe.document.url }}" target="_blank">
                                    {{ piece_jointe.title|default:piece_jointe.document.title|default:piece_jointe.document.filename }}
                                </a>
                            </span>
                        {% endif %}
                    {% endfor %}
                    </ul>
                </div>
                
                {% if is_pdf %}
                    {% comment %} Image de pied de page {% endcomment %}
                    {% if settings.dashboard.PDFSettings.footer_image %}
                        {% image settings.dashboard.PDFSettings.footer_image original class="footer-image" alt="Footer Image" %}
                    {% endif %}
                {% endif %}
            </div>
        {% endif %}
    </main>
{% endblock %}